import{_ as Z,o as h,c as p,a as l,n as $,t as b,b as V,r as v,F as w,d as S,u as _,w as F,v as N,e as re,f as H,g as le,h as E,i as ie}from"./index-B5_gxkSr.js";let L=class ee{constructor(e){this.score=0,this.te=[],this.sute=[],this.yama=e,this.ignition=!1,this.timesDict={},this.timesCount=0,this.sp="",this.effects={},this.teMax=8,this.apMax=20}getAllCards(){return[...this.te,...this.sute,...this.yama]}getDrawYama(){return this.yama.length?this.yama:this.sute}start(){for(let e=0;e<this.teMax;e++){let s=Math.floor(Math.random()*this.yama.length),r=this.yama.splice(s,1)[0];this.te.push(r)}}draw(e,s){this.yama.length||(this.yama=[...this.sute],this.sute=[],this.effects.a&&this.yama.forEach(u=>{u.getMain(this)=="reshuffle"&&(u.cost+=1)}));let r;s?(r=this.yama.filter(u=>Object.keys(s).map(f=>u[f]==s[f])),r.length||(r=this.yama)):r=this.yama;let a=Math.floor(Math.random()*r.length),o=r[a];this.yama.splice(this.yama.findIndex(u=>u.short==o.short),1),this.te[e]=o,o.onDraw(this)}useCard(e){var a,o,u,f,C,y;let s=this.te[e],r=s.isReshuffle(this);s.onSkill(this);for(let d of this.te)d.onCross(this,s);if(this.sp=="sy"&&this.score++,r){for(let d in this.te)d!=e&&this.sute.push(this.te[d]);(a=s.props)!=null&&a.yamaReshuffle&&this.yama.push(...this.sute.splice(0));for(let d=0;d<this.teMax;d++)this.draw(d,(u=(o=s.props)==null?void 0:o.drawFilters)==null?void 0:u[d])}else this.draw(e,(C=(f=s.props)==null?void 0:f.drawFilters)==null?void 0:C[0]);if((y=s.props)!=null&&y.once||this.sute.push(s),s.cost=s.props.cost,s.afterSkill(this),this.timesCount++,this.effects.b&&this.timesCount%5==0){this.sute.push(...this.te.splice(0));for(let d=0;d<this.teMax;d++)this.draw(d)}}testCard(e){var a;let s=new ee([]);for(let o of this.te)s.te.push(o.copy());s.ignition=this.ignition,s.timesDict=this.timesDict,s.sp=this.sp;let r=s.te[e];r.isReshuffle(this),r.onSkill(s);for(let o of s.te)o.onCross(s,r);return(a=r.props)!=null&&a.once||s.sute.push(r),r.cost=r.props.cost,s.score}trigger(e){this.addHeart(e.heart),this.addVoltage(e.voltage),this.addMental(e.mental),this.addProtect(e.protect)}addHeart(e){e&&(this.score+=e)}addVoltage(e){e&&this.sp=="td"&&(this.score+=e)}addMental(e){e&&this.sp=="mg2"&&(this.score+=e)}addProtect(e){e&&this.sp=="mg2"&&(this.score+=e)}};class g{constructor(e){this.short=e,this.props={short:e};let s=U.find(r=>r.short==e);if(s){this.props=s,this.member=s.member;let r=oe.find(a=>a.member==s.member);r&&(this.year=r.year,this.unit=r.unit),this.cost=s.cost,this.teCostDelta=0}}copy(){let e=new g(this.short);return e.cost=this.cost,e.teCostDelta=this.teCostDelta,e}getMain(e){var s;return(s=this.props)!=null&&s.main?typeof this.props.main=="function"?this.props.main(e):this.props.main:""}getCost(e=!1){let s=this.cost;return e&&(s+=this.teCostDelta),s>=1?s:1}isReshuffle(e){var s;return(s=this.props)!=null&&s.reshuffle?typeof this.props.reshuffle=="function"?this.props.reshuffle(e):this.props.reshuffle:!1}onSkill(e){var s;(s=this.props)!=null&&s.skill&&(typeof this.props.skill=="function"?this.props.skill(e):e.trigger(this.props.skill))}afterSkill(e){var s;(s=this.props)!=null&&s.afterSkill&&this.props.afterSkill(e)}onDraw(e){var s;this.teCostDelta=0,(s=this.props)!=null&&s.draw&&(typeof this.props.draw=="function"?this.props.draw(e,this):e.trigger(this.props.draw))}onCross(e,s){var r;(r=this.props)!=null&&r.cross&&this.props.cross(e,s,this)}}const oe=[{member:3,short:"kz",year:102,unit:"srb"},{member:4,short:"td",year:102,unit:"drk"},{member:6,short:"mg",year:102,unit:"mrp"},{member:1,short:"kh",year:103,unit:"srb"},{member:2,short:"sy",year:103,unit:"drk"},{member:5,short:"rr",year:103,unit:"mrp"},{member:7,short:"gn",year:104,unit:"srb"},{member:8,short:"sz",year:104,unit:"drk"},{member:9,short:"hm",year:104,unit:"mrp"}],U=[{short:"Âú£Â§úÂêü",member:7,cost:8,main:"dress",reshuffle:!0,skill(t){for(let e=0;e<5;e++)t.yama.push(new g("Âú£Â§úüëó"))}},{short:"Âú£Â§úüëó",member:"dress",cost:3,main:"reshuffle",reshuffle:!0,once:!0,skill:{mental:1,voltage:1}},{short:"lttfÈìÉ",member:8,cost:9,main:"voltage",drawFilters:[{member:9}]},{short:"‰∏äÂçáÂß¨ËäΩ",member:9,cost:3,main(t){return t!=null&&t.ignition?"reshuffle":"mental"},reshuffle:t=>t==null?void 0:t.ignition,skill:{mental:1,protect:1},afterSkill(t){t.ignition&&(t.timesDict[this.short]==null?t.timesDict[this.short]=0:t.timesDict[this.short]++,t.timesDict[this.short]>=3&&(t.ignition=!1,t.timesDict[this.short]=void 0),t.getAllCards().forEach(e=>{e.unit=="mrp"&&(e.cost-=3)}))},cross(t,e){if(!t.ignition){let s=e.getMain(t);(s=="mental"||s=="protect")&&(t.ignition=!0)}}},{short:"paÂß¨ËäΩ",member:9,cost:4,main:"reshuffle",reshuffle:!0,skill:{protect:1}},{short:"ÁªáÂß¨Ëä±Â∏Ü",member:1,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1}},{short:"Èü≥ÂáªËä±Â∏Ü",member:1,cost:9,main:"heart",reshuffle:!0,yamaReshuffle:!0,skill:{heart:3},draw:{heart:1,mental:1}},{short:"lttfÊ≤ôËÄ∂",member:2,cost:5,main:"voltage",drawFilters:[{member:6}]},{short:"Ê≤èËå∂Áë†ÁíÉ",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{voltage:1},draw:{heart:1}},{short:"ËõãÁ≥ïÁë†ÁíÉ",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{heart:1},draw:{heart:1}},{short:"Ëä±ÁªìÊ¢¢",member:3,cost:13,main:"reshuffle",reshuffle:!0,drawFilters:[{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"}],cross(t,e,s){e.unit=="srb"&&(t.trigger({heart:1}),s.teCostDelta-=3)},afterSkill(t){t.getAllCards().forEach(e=>{(e.unit=="srb"||e.member=="dress")&&(e.cost-=3)})}},{short:"kolÊ¢¢",member:3,cost:9,main:"mental",skill:{mental:1,heart:1},draw(t){t.getAllCards().forEach(e=>{e.member==6&&(e.cost-=9)})},cross(t,e){e.member==6&&t.trigger({protect:1,heart:1})}},{short:"Ëá™Áî±ÁºÄ",member:4,cost:2,main:"mental",skill:{mental:1,heart:1},draw:{heart:1}},{short:"Èì∂Ê≤≥ÊÖà",member:6,cost:5,main:"reshuffle",reshuffle:!0,skill:{mental:2,protect:1}},{short:"kolÊÖà",member:6,cost:39,main:"heart",skill:{heart:2},cross(t,e,s){(e.member==1||e.member==2||e.member==3||e.member==4||e.member==5||e.member==7||e.member==8||e.member==9)&&(s.teCostDelta-=3)},afterSkill(t){t.yama.push(new g("üíé"))}},{short:"üíé",member:"jewelry",cost:1,main:"ap-",once:!0,draw:{heart:1,voltage:1,protect:1}},{short:"paÂêü",member:7,cost:4,main:"dress",skill(t){for(let e=0;e<2;e++)t.yama.push(new g("paÂêüüëó"))}},{short:"paÂêüüëó",member:"dress",cost:2,main:"ap",once:!0},{short:"kolÁºÄ",member:4,cost:3,main:"voltage",skill:{voltage:1,heart:1},draw(t){t.getAllCards().forEach(e=>{(e.member==3||e.member==6)&&(e.cost-=3)})},cross(t,e){e.member==6&&t.trigger({voltage:1,heart:1})}},{short:"hsctÊÖà",member:6,cost:4,main:"reshuffle",reshuffle:!0},{short:"Ëàû‰ºöÁºÄ",member:4,cost:2,main:"voltage",skill:{voltage:1}},{short:"Ëàû‰ºöÊ≤ôËÄ∂",member:2,cost:2,main:"love+"}],ne={class:"cost"},ae={key:0,class:"close"},ue={key:1,class:"test"},me={key:2,class:"time"},he={__name:"Card",props:{card:{type:g},stage:{type:L},te:{default:!1},close:{default:!1},pointerEvents:{default:"auto"}},setup(t){const e=t,s={heart:"rgb(204,39,39)","love+":"rgb(174,141,24)",voltage:"rgb(174,141,24)",mental:"rgb(48,124,24)",reshuffle:"rgb(134,82,195)",protect:"rgb(48,124,24)",dress:"rgb(134,82,195)",ap:"rgb(174,141,24)","ap-":"rgb(134,82,195)","":"transparent"},r={1:"#f8b500",2:"#5383c3",3:"#68be8d",4:"#ba2636",5:"#e7609e",6:"#c8c2c6",7:"#a2d7dd",8:"#fad764",9:"#9d8de2"};return(a,o)=>{var u,f;return h(),p("div",{class:"card",style:$({pointerEvents:t.te&&e.card.getCost(t.te)>20?"none":e.pointerEvents})},[l("div",{class:"background",style:$({backgroundColor:r[e.card.member]?`${r[e.card.member]}`:"transparent"})},null,4),l("div",{style:$({fontWeight:e.card.isReshuffle(e.stage)?"bold":""})},b(e.card.short),5),l("div",ne,b(e.card.getCost(t.te)),1),l("div",{class:"main",style:$({backgroundColor:s[e.card.getMain(e.stage)]})},null,4),e.close?(h(),p("div",ae,"√ó")):V("",!0),e.te?(h(),p("div",ue,b(e.stage.testCard(e.stage.te.indexOf(e.card))),1)):V("",!0),((u=e.stage)==null?void 0:u.timesDict[e.card.short])!=null?(h(),p("div",me,b((f=e.stage)==null?void 0:f.timesDict[e.card.short]),1)):V("",!0)],4)}}},A=Z(he,[["__scopeId","data-v-87406ac9"]]);function R(t){let e=[];for(let s=0;s<t.te.length;s++)t.te[s].getCost()<=t.apMax&&e.push(s);return e}function j(t,e){let s=e.map(a=>t.testCard(a)),r=Math.max(...s);return e.filter((a,o)=>s[o]==r)}function P(t,e){let s=e.map(a=>t.te[a].getCost(!0)),r=Math.min(...s);return e.filter((a,o)=>s[o]==r)}function W(t,e){let s=t.getDrawYama(),r=e.map(o=>{var C,y;let u=t.te[o],f=s;if((C=u.props)!=null&&C.drawFilters){let d=(y=u.props)==null?void 0:y.drawFilters[0];f=s.filter(M=>Object.keys(d).map(m=>M[m]==d[m])),f.length||(f=s)}return f.filter(d=>d.isReshuffle(t)).length/f.length}),a=Math.max(...r);return e.filter((o,u)=>r[u]==a)}function G(t,e){let s=e.filter(r=>{var a,o;return(o=(a=t.te[r].props)==null?void 0:a.drawFilters)==null?void 0:o.length});return s.length?s:e}function J(t,e){let s=e.filter(r=>{var a;return(a=t.te[r].props)==null?void 0:a.yamaReshuffle});return s.length?s:e}function I(t,e){let s=e.filter(r=>t.te[r].member=="dress");return s.length?s:e}function T(t,e){let s=e.filter(r=>t.te[r].getMain(t)!="dress");return s.length?s:e}function q(t,e){let s=e.filter(r=>{var a;return typeof((a=t.te[r].props)==null?void 0:a.reshuffle)!="function"});return s.length?s:e}function Q(t,e){let s=e.filter(r=>t.te[r].member!="jewelry");return s.length?s:e}function X(t,e=9,s="score"){let r,a;if(!t.ignition&&t.te.find(o=>o.short=="‰∏äÂçáÂß¨ËäΩ")&&t.te.find(o=>(o.getMain(t)=="mental"||o.getMain(t)=="protect")&&o.short!="‰∏äÂçáÂß¨ËäΩ"))s=="cost"?r=j(t,P(t,R(t).filter(o=>{let u=t.te[o];return(u.getMain(t)=="mental"||u.getMain(t)=="protect")&&u.short!="‰∏äÂçáÂß¨ËäΩ"})))[0]:r=j(t,R(t).filter(o=>{let u=t.te[o];return(u.getMain(t)=="mental"||u.getMain(t)=="protect")&&u.short!="‰∏äÂçáÂß¨ËäΩ"}))[0];else if(a=t.te.findIndex(o=>o.short=="kolÊÖà"),a>=0&&t.getAllCards().filter(o=>o.member=="jewelry").length<e&&t.te[a].getCost(!0)<(s=="score"?t.apMax:10))r=a;else if(R(t).find(o=>t.te[o].isReshuffle(t))!=null){let o=R(t).filter(u=>t.te[u].isReshuffle(t));s=="cost"?r=G(t,q(t,j(t,P(t,T(t,I(t,J(t,o)))))))[0]:r=G(t,j(t,q(t,T(t,I(t,J(t,o))))))[0]}else s=="cost"?r=j(t,P(t,W(t,Q(t,T(t,I(t,R(t)))))))[0]:r=j(t,W(t,Q(t,T(t,I(t,R(t))))))[0];if(r==null)debugger;return r}const fe={class:"grid"},de={class:"grid"},pe=["disabled"],ce=["disabled"],be=["disabled"],ve=["disabled"],ye=["disabled"],ke=["disabled"],ge={style:{"text-align":"right"}},we={key:0,style:{width:"100%"}},Ce={style:{float:"right"}},Me={key:0},De={key:1},xe={class:"grid"},Se={class:"grid"},Fe={class:"grid"},Re={__name:"Stage",setup(t){const e=v(!1),s=v(!1),r=v({}),a=v(9),o=v(20),u=v(360),f=v(36),C=v("mg2"),y=v({}),d=U.map(k=>new g(k.short)),M=v(U.filter(k=>typeof k.member=="number").map(k=>new g(k.short)).slice(0,14)),m=v(new L([])),te=()=>{e.value=!1,r.value={},O()},O=()=>{m.value=new L([]),m.value.sp=C.value,m.value.effects=y.value},z=async k=>{var i;if(e.value=!0,s.value=k,k)for(let n=0;n<=Number(o.value)&&(await se(100),!!e.value);n++){r.value[n]={list:[]};let c=0,D=0;for(let Y=0;Y<Number(f.value);Y++){O(),m.value.yama=M.value.map(x=>new g(x.short)),m.value.start();for(let x=0;x<Number(u.value)&&e.value;x++)m.value.useCard(X(m.value,n,m.value.sp=="mg2"?"score":"cost"));if(!e.value)break;c+=m.value.score,D+=(i=m.value.getAllCards().filter(x=>x.member=="jewelry"))==null?void 0:i.length}if(r.value[n].score=Number((c/f.value).toFixed(2)),r.value[n].jewelryCount=Number((D/f.value).toFixed(2)),!e.value)break}else m.value.yama=M.value.map(n=>new g(n.short)),m.value.start(),K()},se=async k=>new Promise(i=>setTimeout(i,k)),B=v(-1),K=()=>{B.value=X(m.value,a.value,m.value.sp=="mg2"?"score":"cost")};return(k,i)=>(h(),p("div",null,[e.value?V("",!0):(h(),p(w,{key:0},[i[8]||(i[8]=l("h2",null,"DECK",-1)),i[9]||(i[9]=l("hr",null,null,-1)),l("div",fe,[(h(!0),p(w,null,S(M.value,(n,c)=>(h(),E(A,{key:c,card:n,close:!0,onClick:D=>M.value.splice(c,1)},null,8,["card","onClick"]))),128))]),i[10]||(i[10]=l("h2",null,"CARD",-1)),i[11]||(i[11]=l("hr",null,null,-1)),l("div",de,[(h(!0),p(w,null,S(_(d),(n,c)=>(h(),E(A,{key:c,card:n,onClick:D=>M.value.push(new(_(g))(n.short))},null,8,["card","onClick"]))),128))])],64)),l("form",null,[i[19]||(i[19]=l("h2",null,"STAGE",-1)),i[20]||(i[20]=l("hr",null,null,-1)),l("div",null,[i[12]||(i[12]=l("label",{for:"jewelry"},"JEWELRY: ",-1)),F(l("input",{"onUpdate:modelValue":i[0]||(i[0]=n=>o.value=n),disabled:e.value,type:"number",id:"jewelry"},null,8,pe),[[N,o.value]])]),l("div",null,[i[14]||(i[14]=l("label",{for:"sp"},"SP: ",-1)),F(l("select",{"onUpdate:modelValue":i[1]||(i[1]=n=>C.value=n),disabled:e.value,id:"sp"},i[13]||(i[13]=[l("option",{value:""},"--",-1),l("option",{value:"td"},"Ëàû‰ºöÁºÄ",-1),l("option",{value:"sy"},"Ëàû‰ºöÊ≤ôËÄ∂",-1),l("option",{value:"mg2"},"Èì∂Ê≤≥ÊÖà",-1)]),8,ce),[[re,C.value]])]),l("div",null,[F(l("input",{"onUpdate:modelValue":i[2]||(i[2]=n=>y.value.a=n),disabled:e.value,type:"checkbox",id:"104-3-3-1-a"},null,8,be),[[H,y.value.a]]),i[15]||(i[15]=l("label",{for:"104-3-3-1-a"}," Â±±Êú≠Âàá mainÊïàÊûúreshuffleÊïàÊûúdeckÂÖ®cardÊ∂àË¥πAP+1 ",-1))]),l("div",null,[F(l("input",{"onUpdate:modelValue":i[3]||(i[3]=n=>y.value.b=n),disabled:e.value,type:"checkbox",id:"104-3-3-1-b"},null,8,ve),[[H,y.value.b]]),i[16]||(i[16]=l("label",{for:"104-3-3-1-b"}," skill5Âõû‰ΩøÁî® ÊâãÊú≠ÂÖ®Êç® Â±±Êú≠ÊâãÊú≠‰∏äÈôêÂºïÁõ¥ ",-1))]),l("div",null,[i[17]||(i[17]=l("label",{for:"card-time"},"CARDÂõûÊï∞: ",-1)),F(l("input",{"onUpdate:modelValue":i[4]||(i[4]=n=>u.value=n),disabled:e.value,type:"number",id:"card-time"},null,8,ye),[[N,u.value]])]),l("div",null,[i[18]||(i[18]=l("label",{for:"skip-time"},"SKIPÂõûÊï∞: ",-1)),F(l("input",{"onUpdate:modelValue":i[5]||(i[5]=n=>f.value=n),disabled:e.value,type:"number",id:"skip-time"},null,8,ke),[[N,f.value]])])]),l("div",ge,[e.value?(h(),p("button",{key:0,onClick:te},"RETIRE")):(h(),p(w,{key:1},[l("button",{onClick:i[6]||(i[6]=n=>z(!0))},"SKIP"),l("button",{onClick:i[7]||(i[7]=n=>z(!1))},"LIVE START")],64))]),e.value?(h(),p(w,{key:1},[s.value?(h(),p("table",we,[i[21]||(i[21]=l("tr",null,[l("td",null,"target jewelry"),l("td",null,"actual jewelry"),l("td",null,"score"),l("td",null,"percent")],-1)),(h(!0),p(w,null,S(r.value,(n,c)=>(h(),p("tr",{key:c},[l("td",null,b(c),1),l("td",null,b(n.jewelryCount),1),l("td",null,b(n.score),1),l("td",null,b(Number((n.score/Math.max(...Object.values(r.value).map(D=>D.score))*100).toFixed(2))),1)]))),128))])):(h(),p(w,{key:1},[l("h2",null,[le(b(m.value.score)+" ",1),l("div",Ce,b(m.value.timesCount)+"Âõû",1)]),m.value.ignition?(h(),p("h2",Me,"üî•")):(h(),p("h2",De,"üö´")),l("h2",null,"ÊâãÊú≠ "+b(m.value.te.length),1),i[22]||(i[22]=l("hr",null,null,-1)),l("div",xe,[(h(!0),p(w,null,S(m.value.te,(n,c)=>(h(),E(A,{key:c,card:n,stage:m.value,te:!0,class:ie({highlight:B.value==c}),onClick:D=>{m.value.useCard(c),K()}},null,8,["card","stage","class","onClick"]))),128))]),l("h2",null,"Êç®Êú≠ "+b(m.value.sute.length),1),i[23]||(i[23]=l("hr",null,null,-1)),l("div",Se,[(h(!0),p(w,null,S(m.value.sute,(n,c)=>(h(),E(A,{key:c,card:n,stage:m.value,"pointer-events":"none"},null,8,["card","stage"]))),128))]),l("h2",null,"Â±±Êú≠ "+b(m.value.yama.length),1),i[24]||(i[24]=l("hr",null,null,-1)),l("div",Fe,[(h(!0),p(w,null,S(m.value.yama,(n,c)=>(h(),E(A,{key:c,card:n,stage:m.value,"pointer-events":"none"},null,8,["card","stage"]))),128))])],64))],64)):V("",!0)]))}},Ee=Z(Re,[["__scopeId","data-v-b948b128"]]);export{Ee as default};
