import{_ as te,o as b,c as g,a as l,n as q,t as v,e as N,f as j,F as T,d as C,g as P,u as J,h as w,v as E,i as G,j as Y,k as W,l as H,m as le}from"./index-CyNDwZSX.js";class F{constructor(e){this.short=e,this.props={short:e};let t=K.find(a=>a.short==e);if(t){this.props=t,this.member=t.member;let a=ie.find(i=>i.member==t.member);a&&(this.year=a.year,this.unit=a.unit),this.cost=t.cost,this.costDelta=0,this.teCostDelta=0}}copy(){let e=new F(this.short);return e.cost=this.cost,e.costDelta=this.costDelta,e.teCostDelta=this.teCostDelta,e}getMain(e){var t;return(t=this.props)!=null&&t.main?typeof this.props.main=="function"?this.props.main(e):this.props.main:""}getCost(e=!1){var a,i;let t=this.cost;return t+=this.costDelta,e&&((a=this.props)!=null&&a.teCostDelta)&&(t+=(i=this.props)==null?void 0:i.teCostDelta(e)),e&&(t+=this.teCostDelta),t>=1?t:1}getCalcCost(e){let t=this.getSkill(e),a=this.getCost(e.te),i=a;return i-=(t==null?void 0:t.ap)??0,i-=(t==null?void 0:t.spAp)??0,(i<1||i>=e.apMax&&a<=e.ap)&&(i=1),i}isReshuffle(e){var t;return(t=this.props)!=null&&t.reshuffle?typeof this.props.reshuffle=="function"?this.props.reshuffle(e):this.props.reshuffle:!1}getSkill(e){var t;if((t=this.props)!=null&&t.skill)return typeof this.props.skill=="function"?this.props.skill(e):this.props.skill}onSkill(e){e.trigger(this.getSkill(e))}afterSkill(e){var t;(t=this.props)!=null&&t.afterSkill&&this.props.afterSkill(e,this)}onDraw(e){var t;this.teCostDelta=0,(t=this.props)!=null&&t.draw&&(typeof this.props.draw=="function"?e.trigger(this.props.draw(e,this)):e.trigger(this.props.draw))}calcDrawHeartCount(e){var m,o,h,y;let t=0,a;(m=this.props)!=null&&m.draw&&(typeof((o=this.props)==null?void 0:o.draw)=="function"?a=(h=this.props)==null?void 0:h.draw(e):a=(y=this.props)==null?void 0:y.draw),t+=(a==null?void 0:a.heart)||0,e.sp=="tz"&&(t+=(a==null?void 0:a.voltage)||0),e.sp=="mg2"&&(t+=((a==null?void 0:a.mental)||0)+((a==null?void 0:a.protect)||0));let i=0,u=this.getSkill(e);return(u==null?void 0:u.ap)<0&&(i+=u.heart||0,e.sp=="tz"&&(i+=(u==null?void 0:u.voltage)||0),e.sp=="mg2"&&(i+=((u==null?void 0:u.mental)||0)+((u==null?void 0:u.protect)||0)),e.getAllCards().length/e.teMax,t+=i),t}onCross(e,t,a){var i;(i=this.props)!=null&&i.cross&&this.props.cross(e,t,a,this)}matchAttrs(e){return Object.keys(e).every(t=>e[t]==null?!0:e[t]==this[t])}calcSubtractAp(e){let t=0;if(e!=null&&e.length)for(let a of e)this.matchAttrs({...a,cost:void 0})&&(t+=a.cost);return t}}const ie=[{member:3,short:"kz",year:102,unit:"srb"},{member:4,short:"tz",year:102,unit:"drk"},{member:6,short:"mg",year:102,unit:"mrp"},{member:1,short:"kh",year:103,unit:"srb"},{member:2,short:"sy",year:103,unit:"drk"},{member:5,short:"rr",year:103,unit:"mrp"},{member:7,short:"gn",year:104,unit:"srb"},{member:8,short:"sz",year:104,unit:"drk"},{member:9,short:"hm",year:104,unit:"mrp"}],K=[{short:"圣夜吟",member:7,cost:8,main:"dress",reshuffle:!0,skill:{cards:["圣夜👗","圣夜👗","圣夜👗","圣夜👗","圣夜👗"]}},{short:"圣夜👗",member:"dress",cost:3,main:"reshuffle",reshuffle:!0,once:!0,skill:{mental:1,voltage:1}},{short:"pa吟",member:7,cost:4,main:"dress",skill:{cards:["pa👗","pa👗"]}},{short:"pa👗",member:"dress",cost:2,main:"ap",once:!0},{short:"lttf铃",member:8,cost:9,main:"voltage",skill:{voltage:1,mental:-1},drawFilters:[{member:9}]},{short:"上升姬芽",member:9,cost:3,main(r){return r!=null&&r.ignition?"reshuffle":"mental"},reshuffle:r=>r==null?void 0:r.ignition,skill(r){let e={mental:1,protect:1};return r.ignition&&(e["ap-"]=[{unit:"mrp",cost:-3}]),e},ignitionTimes:3,cross(r,e,t){r.ignition||(t=="mental"||t=="protect")&&(r.ignition=!0)}},{short:"pa姬芽",member:9,cost:4,main:"reshuffle",reshuffle:!0,skill:{protect:1}},{short:"织姬花帆",member:1,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1}},{short:"音击花帆",member:1,cost:9,main:"heart",reshuffle:!0,yamaReshuffle:!0,skill:{heart:3},draw:{heart:1,mental:1}},{short:"lttf沙耶",member:2,cost:5,main:"voltage",skill:{voltage:1},drawFilters:[{member:6}]},{short:"沏茶瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{voltage:1},draw:{heart:1}},{short:"蛋糕瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{heart:1},draw:{heart:1}},{short:"花结梢",member:3,cost:13,main:"reshuffle",reshuffle:!0,drawFilters:[{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"}],skill:{"ap-":[{unit:"srb",cost:-3},{member:"dress",cost:-3}]},cross(r,e,t,a){e.unit=="srb"&&(r.trigger({heart:1}),a.teCostDelta-=3)}},{short:"kol梢",member:3,cost:9,main:"mental",skill:{mental:1,heart:1},draw:{"ap-":[{member:6,cost:-9}]},cross(r,e){e.member==6&&r.trigger({protect:1,heart:1})}},{short:"自由缀",member:4,cost:2,main:"mental",skill:{mental:1,heart:1},draw:r=>{let e={};return r.mental&&(e={heart:1}),e}},{short:"kol缀",member:4,cost:3,main:"voltage",skill:{voltage:1,heart:1},draw:{"ap-":[{member:3,cost:-3},{member:6,cost:-3}]},cross(r,e){e.member==6&&r.trigger({voltage:1,heart:1})}},{short:"af慈",member:6,cost:9,main:"protect",skill(r){let e={protect:1,heart:10,ap:-1/0};return r.sp=="mg2"&&(e.heart=9,e.spAp=15),e}},{short:"kol慈",member:6,cost:39,main:"heart",skill:{heart:2,cards:["💎"]},cross(r,e,t,a){(e.member==1||e.member==2||e.member==3||e.member==4||e.member==5||e.member==7||e.member==8||e.member==9)&&(a.teCostDelta-=3)}},{short:"💎",member:"jewelry",cost:1,main:"ap-",once:!0,skill:{"ap-":[{cost:-1}]},draw:{heart:1,voltage:1,protect:1}},{short:"舞会缀",member:4,cost:2,main:"voltage",skill:{voltage:1}},{short:"舞会沙耶",member:2,cost:2,main:"love+"},{short:"银河缀",member:4,cost:2,main:"voltage",skill(r){let e={voltage:1,heart:1};return r.sp=="tz2"&&(e.spAp=5),e}},{short:"银河慈",member:6,cost:5,main:"reshuffle",reshuffle:!0,skill(r){let e={mental:2,protect:1};return r.sp=="mg2"&&(e.spAp=20),e}},{short:"讴歌梢",member:3,cost:3,main:"love+",draw:{heart:1}},{short:"ritm梢",member:3,cost:2,main:"voltage",skill:{voltage:1},draw:{mental:1}},{short:"秋色梢",member:3,cost:6,main:"love+",draw:{mental:1}},{short:"自由梢",member:3,cost:2,main:"protect",skill:{protect:1},draw:r=>{let e={};return r.mental&&(e={protect:1}),e}},{short:"教师梢",member:3,cost:2,main:"heart",skill:{heart:1,mental:-1},draw:{mental:1}},{short:"蓝远梢",member:3,cost:3,main:"dress",skill:{cards:["蓝远梢👗"]},cross(r,e){e.unit=="srb"&&r.trigger({voltage:1})}},{short:"蓝远梢👗",member:"dress",cost:3,main:"love+",once:!0},{short:"水母梢",member:3,cost:5,main:"love+",draw:{cards:["⚪"]}},{short:"⚪",member:"bubble",cost:1,main:"ap-",once:!0,skill:{"ap-":[{unit:"srb",cost:-3},{member:"dress",cost:-3}]}},{short:"ss缀",member:4,cost:3,main:"heart",skill:{heart:1},draw:{voltage:1}},{short:"雨伞缀",member:4,cost:5,main:"love+",draw:{heart:1}},{short:"花火缀",member:4,cost:3,main:"voltage",skill:{voltage:1},draw:{voltage:1}},{short:"秋色缀",member:4,cost:6,main:"heart",skill:r=>{let e={};return r.mental?e={heart:3}:e={heart:2},e},draw:{mental:1}},{short:"抱花缀",member:4,cost:4,main:"voltage",skill:{voltage:1},draw:{voltage:1}},{short:"音击缀",member:4,cost:9,main:"voltage",skill:{voltage:1,heart:3},draw:{voltage:1,protect:1}},{short:"af缀",member:4,cost:9,main:"voltage",skill(r){let e={voltage:2,heart:10,ap:-1/0};return r.sp=="tz"&&(e.heart=9),r.sp=="tz2"&&(e.spAp=20),e}},{short:"蛋糕慈",member:6,cost:4,main:"mental",skill:{mental:1},draw:{mental:1,protect:1}},{short:"舞会慈",member:6,cost:3,main:"love+",yamaUse:!0,skill:{mental:-1},draw:{mental:1}},{short:"圣诞慈",member:6,cost:4,main:"mental",skill:{mental:3},draw:{mental:1}},{short:"抱花慈",member:6,cost:4,main:"protect",skill:{protect:1},draw:{protect:1}},{short:"hsct慈",member:6,cost:4,main:"reshuffle",reshuffle:!0},{short:"ritm花帆",member:1,cost:1,main:"heart",skill:{heart:1},draw:{mental:1}},{short:"讴歌花帆",member:1,cost:3,main:"mental",skill:{mental:1},draw:{voltage:1}},{short:"雨伞花帆",member:1,cost:3,main:"voltage",skill:{voltage:1},draw:{mental:1}},{short:"自由花帆",member:1,cost:2,main:"voltage",skill:{voltage:1,heart:1},draw:r=>{let e={};return r.mental&&(e={voltage:1}),e}},{short:"舞会花帆",member:1,cost:6,main:"heart",skill:{heart:1}},{short:"偶活花帆",member:1,cost:9,main:"heart",reshuffle:!0,skill:{heart:1},cross(r,e,t,a){(e.member==2||e.member==5)&&(a.teCostDelta-=2)}},{short:"快乐花帆",member:1,cost:2,main:"mental",skill:{mental:1,voltage:1},draw:{mental:1,heart:1}},{short:"蓝远花帆",member:1,cost:3,main:"dress",skill:{cards:["蓝远花帆👗"]},cross(r,e){e.unit=="srb"&&r.trigger({voltage:1})}},{short:"蓝远花帆👗",member:"dress",cost:3,main:"heart",once:!0,skill:{heart:1}},{short:"雨伞沙耶",member:2,cost:4,main:"mental",skill:{mental:1},draw:{voltage:1}},{short:"tc沙耶",member:2,cost:3,main:"love+",skill:{mental:-1},draw:{voltage:1}},{short:"宇宙沙耶",member:2,cost:4,main:"teMax",skill:{voltage:1}},{short:"沏茶沙耶",member:2,cost:2,main:"love+",skill:{voltage:1}},{short:"圣诞沙耶",member:2,cost:4,main:"voltage",skill:{voltage:1,heart:2},draw:{voltage:1}},{short:"db瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{voltage:1},draw:{voltage:1}},{short:"梦境瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{heart:1}},{short:"rod瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1},draw:{mental:1}},{short:"一专瑠璃",member:5,cost:5,main:"reshuffle",reshuffle:!0,skill:{heart:1}},{short:"abdl瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1}},{short:"白昼瑠璃",member:5,cost:3,main:"reshuffle",reshuffle:!0,skill:{mental:-1},draw:{heart:1}},{short:"mc瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill(r){let e;return r.ignition?e={heart:1}:e={ap:1},e}},{short:"ritm吟",member:7,cost:5,main:"dress",skill:{cards:["ritm👗1","ritm👗2","ritm👗3"]},draw:{protect:1}},{short:"ritm👗1",member:"dress",cost:1,main:"heart",once:!0,skill:{heart:1}},{short:"ritm👗2",member:"dress",cost:1,main:"voltage",once:!0,skill:{voltage:1}},{short:"ritm👗3",member:"dress",cost:1,main:"teMax",once:!0},{short:"蓝远吟",member:7,cost:3,main:"dress",skill:{cards:["蓝远👗","蓝远👗","蓝远👗"]},cross(r,e){e.unit=="srb"&&r.trigger({voltage:1})}},{short:"蓝远👗",member:"dress",cost:2,main:"reshuffle",reshuffle:!0,once:!0,skill:{heart:1}},{short:"花结吟",member:7,cost:13,teCostDelta(r){let e=0;for(let t of r)t.unit=="srb"&&(e-=3);return e},main:"dress",reshuffle:!0,skill:{cards:["花结👗1","花结👗1","花结👗1","花结👗2","花结👗2","花结👗2","花结👖3","花结👖3","花结👖3"]},drawFilters:[{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"}]},{short:"花结👗1",member:"dress",cost:3,main:"voltage",once:!0,skill(r){let e={voltage:2};return r.getAllCards().length>=33&&(r.sp=="tz2"?e.heart=1:e.heart=2),e}},{short:"花结👗2",member:"dress",cost:3,main:"protect",once:!0,skill(r){let e={protect:1};return r.getAllCards().length>=33&&(r.sp=="mg2"?e.heart=1:e.heart=2),e}},{short:"花结👖3",member:"dress",cost:3,main:"reshuffle",reshuffle:!0,once:!0,skill(r){if(r.getAllCards().length>=30)return{heart:2}},drawFilters:[{unit:"srb"},{unit:"srb"},{unit:"srb"},{unit:"srb"},{unit:"srb"},{unit:"srb"}]},{short:"db铃",member:8,cost:5,main:"heart",skill:{heart:1},afterSkill(r,e){e.costDelta--}},{short:"雪纺铃",member:8,cost:3,main:"mental",skill:{mental:1}}];let re=class se{constructor(e){this.score=0,this.te=[],this.sute=[],this.yama=e,this.mental=!0,this.protect=!1,this.apMax=20,this.ignition=!1,this.ignitionTimesDict={},this.cardTimesDict={apSkip:0},this.timesCount=0,this.cardsCount=0,this.sp="",this.effect="",this.teMax=8,this.ap=0,this.apSpeed=2.5,this.drawHeartCount=0,this.jewelryCountTarget=0,this.hasCostEffect=!1,this.testResults=[],this.hasIgnitionAndScoreCard=!1}getAllCards(){return[...this.te,...this.sute,...this.yama]}getDrawYama(){return this.yama.length?this.yama:this.sute}start(){this.ap=this.apSpeed,this.hasIgnitionAndScoreCard=this.getAllCards().filter(e=>{var t,a,i;return(((t=e.props)==null?void 0:t.main)=="mental"||((a=e.props)==null?void 0:a.main)=="protect")&&(e.isReshuffle(this)||((i=e.getSkill(this))==null?void 0:i.ap)<0)}).length>0,this.sp=="kz2"&&(this.ap=1/0);for(let e=0;e<this.teMax;e++){let t=Math.floor(Math.random()*this.yama.length),a=this.yama.splice(t,1)[0];this.te.push(a)}this.hasCostEffect=["st1a"].includes(this.effect),this.testAllCards()}draw(e,t){this.yama.length||(this.yama=[...this.sute],this.sute=[],this.effect=="kj1a"&&(this.addAp(3),this.yama.forEach(m=>{m.getMain(this)=="reshuffle"&&m.cost++})));let a;t?(a=this.yama.filter(m=>m.matchAttrs(t)),a.length||(a=this.yama)):a=this.yama;let i=Math.floor(Math.random()*a.length),u=a[i];this.yama.splice(this.yama.indexOf(u),1),this.te[e]=u,u.onDraw(this)}autoAp(){this.sp!="kz2"&&this.addAp(this.apSpeed)}useCard(e){var u,m,o,h,y,D,c,A,d;if(e==null){this.cardTimesDict.apSkip++,this.autoAp(),this.timesCount++;return}let t=this.te[e];this.cardTimesDict[t.short]||(this.cardTimesDict[t.short]=0),this.cardTimesDict[t.short]++;let a=t.getMain(this),i=t.isReshuffle(this);this.sp!="kz2"&&this.addAp(-t.getCost(this.te)),t.cost=t.props.cost,t.onSkill(this),this.ignition&&((u=t.props)!=null&&u.ignitionTimes)&&(this.ignitionTimesDict[t.short]==null&&(this.ignitionTimesDict[t.short]=0),this.ignitionTimesDict[t.short]++,this.ignitionTimesDict[t.short]>=((m=t.props)==null?void 0:m.ignitionTimes)&&(this.ignition=!1,this.ignitionTimesDict[t.short]=0));for(let p of this.te)p.onCross(this,t,a);if(this.sp=="sy"&&this.score++,i){for(let p in this.te)p!=e&&this.sute.push(this.te[p]);(o=t.props)!=null&&o.yamaReshuffle&&this.yama.push(...this.sute.splice(0));for(let p=0;p<this.teMax;p++)this.draw(p,(y=(h=t.props)==null?void 0:h.drawFilters)==null?void 0:y[p])}else this.draw(e,(c=(D=t.props)==null?void 0:D.drawFilters)==null?void 0:c[0]);if((A=t.props)!=null&&A.once||((d=t.props)!=null&&d.yamaUse?this.yama.push(t):this.sute.push(t)),t.afterSkill(this),this.timesCount++,this.cardsCount++,this.effect=="gc1a"&&this.cardsCount%30==0)this.getAllCards().forEach(p=>{p.getMain()=="mental"&&p.costDelta--});else if(this.effect=="gc1b"&&this.cardsCount%15==0)this.getAllCards().forEach(p=>{p.unit=="srb"&&p.costDelta--});else if(this.effect=="gc1c"&&this.cardsCount%20==0)this.getAllCards().forEach(p=>{p.unit=="drk"&&p.costDelta--});else if(this.effect=="kj1b"&&this.cardsCount%5==0){this.sute.push(...this.te.splice(0));for(let p=0;p<this.teMax;p++)this.draw(p)}else this.effect=="st1a"&&this.cardsCount%6==0&&this.getAllCards().forEach(p=>p.cost++);!this.protect&&this.sp!="mg2"&&(this.mental=!1),this.autoAp(),this.testAllCards()}calcTestDrawHeartCount(){let e=0,t=this.getAllCards(),a=t.filter(i=>i.short=="💎").length;if(a<this.jewelryCountTarget)for(let i=0;i<this.jewelryCountTarget-a;i++)t.push(new F("💎"));return t.forEach(i=>{e+=i.calcDrawHeartCount(this)}),this.drawHeartCount=e,e}calcNextDrawHeartCount(e){var o;let t=0,a=0,i=[],u=[],m=this.getAllCards();return i=(o=e.props)!=null&&o.yamaReshuffle?m.filter(h=>h!=e):this.yama,i.forEach(h=>{t+=h.calcDrawHeartCount(this)}),i.length<this.teMax?(u=[...this.sute,...this.te.filter(h=>h!=e)],u.forEach(h=>a+=h.calcDrawHeartCount(this)),(t+a/u.length*(this.teMax-i.length))/m.length*Math.min(m.length,this.teMax*2)+this.drawHeartCount*this.teMax/m.length*Math.max(0,m.length-this.teMax*2)/m.length):t/i.length*this.teMax/m.length*Math.min(m.length,this.teMax*2)+this.drawHeartCount*this.teMax/m.length*Math.max(0,m.length-this.teMax*2)/m.length}testCard(e,t){var A,d,p,U,V,O,$,z;let a=t?t.short:this.te[e].short;if(a=="kol慈")return .01;if(a=="💎")return 0;if(["ritm吟","蓝远梢","蓝远花帆","pa吟","花结吟"].includes(a))return-.01;let i=new se([]);for(let f of this.te)i.te.push(f.copy());for(let f of this.sute)i.sute.push(f.copy());for(let f of this.yama)i.yama.push(f.copy());i.mental=this.mental,i.protect=this.protect,i.ap=this.ap,i.apMax=this.apMax,i.apSpeed=this.apSpeed,i.ignition=this.ignition,i.ignitionTimesDict={...this.ignitionTimesDict},i.sp=this.sp,i.jewelryCountTarget=this.jewelryCountTarget;let u,m;if(t&&(u=i.te[e].getCost(i.te),i.te[e]=t,m=i.te[e].getCost(i.te),(i.sp=="mg2"||i.sp=="tz2"||i.sp=="kz2")&&(u=1,m=1),m>i.apMax))return 0;let o=i.te[e],h=o.getSkill(this),y=o.getMain(this),D=o.isReshuffle(i);o.onSkill(i);for(let f of i.te)f.onCross(i,o,y);i.calcTestDrawHeartCount();let c=i.score;if(D&&(c+=i.calcNextDrawHeartCount(o)),((d=(A=o.props)==null?void 0:A.drawFilters)==null?void 0:d.length)==1&&!t){let f=(p=o.props)==null?void 0:p.drawFilters[0],s=i.getDrawYama().filter(n=>Object.keys(f).every(k=>n[k]==f[k]));s.forEach(n=>c+=i.testCard(e,n)/s.length)}return(U=o.props)!=null&&U.once&&(c+=((i.drawHeartCount-o.calcDrawHeartCount(i))/(i.getAllCards().length-1)-i.drawHeartCount/i.getAllCards().length)*(D?this.teMax:this.teMax**3)),(V=h==null?void 0:h.cards)!=null&&V.length&&(c+=(i.drawHeartCount/(i.getAllCards().length+((O=h==null?void 0:h.cards)==null?void 0:O.length))-i.drawHeartCount/i.getAllCards().length)*this.teMax),($=h==null?void 0:h.cards)!=null&&$.length&&(c/=((z=h==null?void 0:h.cards)==null?void 0:z.length)+1),(h==null?void 0:h.ap)<=-i.apMax&&(c/=Math.ceil(Math.min(...i.te.filter(f=>f!=o&&f.member!="jewelry").map(f=>f.getCost()))/i.apSpeed)),o.short=="上升姬芽"&&(this.hasIgnitionAndScoreCard||(c*=3/4),this.hasCostEffect&&(c*=o.getCost())),t&&(c/=Math.max(2,(u+m)/u)),c<0?0:c}testAllCards(){this.testResults=this.te.map((e,t)=>this.testCard(t))}trigger(e){e&&(this.addAp(e.ap),this.addHeart(e.heart),this.addVoltage(e.voltage),this.addMental(e.mental),this.addProtect(e.protect),this.subtractAp(e["ap-"]),this.addCard(e.cards),this.addAp(e.spAp))}addHeart(e){e&&(this.score+=e)}addVoltage(e){e&&(this.sp=="tz"&&(this.score+=e),this.sp=="tz2"&&this.addAp(1*e))}addMental(e){e&&(e>0&&this.sp=="mg2"&&(this.score+=e,this.addAp(1*e)),e>0?this.mental=!0:e<0&&this.sp!="mg2"&&(this.mental=!1))}addProtect(e){e&&(this.sp=="mg2"&&(this.score+=e,this.addAp(2*e)),this.protect=!0)}subtractAp(e){if(e!=null&&e.length)for(let t of this.getAllCards())t.cost+=t.calcSubtractAp(e)}addCard(e){if(e!=null&&e.length)for(let t of e)this.yama.push(new F(t))}addAp(e){if(e){let t=this.ap+e;t>this.apMax&&(t=this.apMax),t<0&&(t=0),this.ap=Number(t.toFixed(2))}}};const ae={class:"cost"},oe={key:0,class:"close"},ne={key:1,class:"test"},ue={key:2,class:"time"},me={__name:"Card",props:{card:{type:F},stage:{type:re},te:{default:!1},close:{default:!1},pointerEvents:{default:"auto"}},setup(r){const e=r,t={heart:"rgb(204,39,39)","love+":"rgb(174,141,24)",voltage:"rgb(174,141,24)",mental:"rgb(48,124,24)",reshuffle:"rgb(134,82,195)",teMax:"rgb(134,82,195)",protect:"rgb(48,124,24)",dress:"rgb(134,82,195)",ap:"rgb(174,141,24)","ap-":"rgb(134,82,195)","":"transparent"},a={1:"#f8b500",2:"#5383c3",3:"#68be8d",4:"#ba2636",5:"#e7609e",6:"#c8c2c6",7:"#a2d7dd",8:"#fad764",9:"#9d8de2",bubble:"#555555",jewelry:"#555555"};return(i,u)=>{var m,o,h,y;return b(),g("div",{class:"card",style:q({pointerEvents:r.te&&e.card.getCost(r.te?e.stage.te:void 0)>e.stage.ap?"none":e.pointerEvents})},[l("div",{class:"background",style:q({backgroundColor:a[e.card.member]?`${a[e.card.member]}`:"transparent"})},null,4),l("div",{style:q({fontWeight:e.card.isReshuffle(e.stage)?"bold":"",fontStyle:e.card.isReshuffle(e.stage)?"italic":""})},v(e.card.short),5),l("div",ae,v(e.card.getCost(r.te?e.stage.te:void 0)),1),l("div",{class:"main",style:q({backgroundColor:t[e.card.getMain(e.stage)]})},null,4),e.close?(b(),g("div",oe,"×")):N("",!0),e.te?(b(),g("div",ne,v(Number(e.stage.testResults[e.stage.te.indexOf(e.card)].toFixed(2))),1)):N("",!0),(m=e.stage)!=null&&m.ignition&&((h=(o=e.card)==null?void 0:o.props)!=null&&h.ignitionTimes)?(b(),g("div",ue,v(((y=e.stage)==null?void 0:y.ignitionTimesDict[e.card.short])??0),1)):N("",!0)],4)}}},L=te(me,[["__scopeId","data-v-b6c7e438"]]);function R(r){let e=[];for(let t=0;t<r.te.length;t++)r.te[t].getCost(r.te)<=r.ap&&r.testResults[t]>=0&&e.push(t);return e}function Q(r,e){let t=e.map(i=>r.testResults[i]),a=Math.max(...t);return e.filter((i,u)=>t[u]==a)}function X(r,e,t){let a=r.te.map((o,h)=>r.testResults[h]/r.te[h].getCalcCost(r)),i=e.map(o=>a[o]),u=Math.max(...i),m=(Math.min(...i)+u)/2;if(!t&&u<=0&&Math.max(...a)>0){let o=e.filter(y=>i[y]>=m),h=Math.min(...o.map(y=>r.te[y].getCost(r.te)));return h<=r.apSpeed?o.filter(y=>r.te[y].getCost(r.te)==h):[]}else return e.filter((o,h)=>i[h]==u)}function de(r,e){let t=e.filter(u=>{var m;return(m=r.te[u].getSkill(r))==null?void 0:m["ap-"]});t.length||(t=e);let a=t.map(u=>{let m=r.te[u],o=0;return r.getAllCards().forEach(h=>{var y,D,c,A;(D=(y=h.props)==null?void 0:y.draw)!=null&&D["ap-"]&&(o+=m.calcSubtractAp((A=(c=h.props)==null?void 0:c.draw)==null?void 0:A["ap-"]))}),o}),i=Math.min(...a);return t.filter((u,m)=>a[m]==i)}function Z(r,e){let t=e.filter(a=>{var i,u;return(u=(i=r.te[a].props)==null?void 0:i.drawFilters)==null?void 0:u.length});return t.length?t:e}function _(r,e){let t=e.filter(a=>r.te[a].member=="dress");return t.length?t:e}function ee(r,e,t){if(r.getAllCards().filter(u=>u.member=="jewelry").length>e)return t;let i=t.filter(u=>r.te[u].member!="jewelry");return i.length?i:t}function B(r,e=8,t){let a,i;if(t==null&&(t=r.strategy??(r.sp=="mg2"||r.sp=="tz2"||r.sp=="kz2"?"score":"cost"),r.ap+r.apSpeed*(r.apMax/10)>=r.apMax&&(t="score")),!r.ignition&&r.te.find(u=>u.short=="上升姬芽")&&r.te.find(u=>(u.getMain(r)=="mental"||u.getMain(r)=="protect")&&u.short!="上升姬芽")&&(t=="score"?a=Q(r,R(r).filter(u=>{let m=r.te[u];return(m.getMain(r)=="mental"||m.getMain(r)=="protect")&&m.short!="上升姬芽"}))[0]:a=X(r,R(r).filter(u=>{let m=r.te[u];return(m.getMain(r)=="mental"||m.getMain(r)=="protect")&&m.short!="上升姬芽"}),!0)[0]),a==null&&(i=r.te.findIndex(u=>u.short=="kol慈"),i>=0&&r.getAllCards().filter(u=>u.member=="jewelry").length<e&&r.te[i].getCost(r.te)<(t=="score"?r.ap-r.apSpeed:r.ap-r.apSpeed*(r.apMax/10))&&(a=i)),a==null&&(i=r.te.findIndex(u=>u.member=="jewelry"&&r.hasCostEffect),i>=0&&r.getAllCards().filter(u=>u.member=="jewelry").length>e&&(a=i)),a==null&&(t=="score"?a=Z(r,ee(r,e,Q(r,_(r,R(r)))))[0]:a=de(r,Z(r,ee(r,e,X(r,_(r,R(r))))))[0]),R(r).length&&a==null)debugger;return a}window.strategyPlay=B;const he={class:"grid"},fe=["open"],pe={class:"grid"},ce={style:{"font-size":"small"}},ve=["disabled"],be=["disabled"],ge=["disabled"],ye=["disabled"],ke=["disabled"],Ce=["disabled"],we=["disabled"],Me=["disabled"],Ae=["disabled"],Se=["disabled"],Te=["disabled"],De=["disabled"],xe=["disabled"],je={style:{"text-align":"right"}},Ee={class:"flex-between"},Fe={class:"flex-between"},Ie={class:"flex-between"},Pe={class:"grid"},ze={class:"grid"},Ne={class:"grid"},Ve={colspan:"6"},$e={colspan:"2"},He={colspan:"2"},Le={colspan:"2"},Re={colspan:"2"},Ue={colspan:"2"},Oe={colspan:"2"},qe=["onClick"],Ge={colspan:"2",style:{"text-align":"center"}},Ke={__name:"Stage",setup(r){const e=j(!1),t=j(!1),a=j([]),i=j(!1),u=j(),m=j(),o=j({qc:140,sh:3.3,deckLength:17,apSpeed:2.34,apMax:20,sp:"",effect:"",jewelryCountTargetMin:0,jewelryCountTargetMax:16,cardTimes:373,skipTimes:36,strategy:"cost",jewelryCountTarget:0});let h=localStorage.getItem("formData");try{h&&(o.value={...o.value,...JSON.parse(h)})}catch{}const y=f=>f.slice().sort((s,n)=>typeof s.member=="number"&&typeof n.member=="number"?s.member-n.member:typeof s.member=="number"&&typeof n.member!="number"?-1:typeof s.member!="number"&&typeof n.member=="number"||s.member>n.member?1:s.member<n.member?-1:0).sort((s,n)=>s.year&&n.year?n.year-s.year:s.year&&!n.year?-1:!s.year&&n.year?1:0),D=y(K.map(f=>new F(f.short))),c=j([]);let A=localStorage.getItem("deck");try{A&&(c.value=JSON.parse(A).map(f=>new F(f)))}catch{}c.value.length||(c.value=K.filter(f=>typeof f.member=="number").map(f=>new F(f.short)).slice(0,16));const d=j();window.getStage=()=>d.value;const p=()=>{d.value=new re([]),d.value.apSpeed=Number(o.value.apSpeed),d.value.apMax=Number(o.value.apMax),d.value.sp=o.value.sp,d.value.effect=o.value.effect,d.value.strategy=o.value.strategy,d.value.yama=c.value.map(f=>new F(f.short))};p();const U=()=>{e.value=!1,p()},V=async f=>{var s;if(localStorage.setItem("formData",JSON.stringify(o.value)),localStorage.setItem("deck",JSON.stringify(c.value.map(n=>n.short))),i.value=!1,e.value=!0,t.value=f,f){a.value.push({deck:c.value.map(n=>n.short).join(", "),formData:{...o.value},dict:{}});for(let n=Number(o.value.jewelryCountTargetMin);n<=Number(o.value.jewelryCountTargetMax)&&e.value;n++){let k=0,M=0,S={apSkip:0};for(let x of c.value)S[x.short]=0;for(let x=0;x<Number(o.value.skipTimes);x++){await O(),p(),d.value.jewelryCountTarget=n,d.value.start();for(let I=0;I<Number(o.value.cardTimes)&&e.value;I++)d.value.useCard(B(d.value,n));if(!e.value)break;k+=d.value.score,M+=(s=d.value.getAllCards().filter(I=>I.member=="jewelry"))==null?void 0:s.length;for(let I in d.value.cardTimesDict)S[I]||(S[I]=0),S[I]+=d.value.cardTimesDict[I]}if(!e.value)break;for(let x in S)S[x]=Number((S[x]/o.value.skipTimes).toFixed(2));a.value.at(-1).dict[n]={score:Number((k/o.value.skipTimes).toFixed(2)),jewelryCount:Number((M/o.value.skipTimes).toFixed(2)),cardTimesDict:S}}e.value=!1}else p(),d.value.jewelryCountTarget=o.value.jewelryCountTarget,d.value.start(),z()},O=async f=>new Promise(s=>setTimeout(s,f)),$=j(-1),z=()=>{$.value=B(d.value,o.value.jewelryCountTarget)};return(f,s)=>(b(),g("div",null,[!e.value||t.value?(b(),g(T,{key:0},[l("h2",null,[s[23]||(s[23]=C(" DECK ")),l("button",{onClick:s[0]||(s[0]=n=>c.value=y(c.value))},"⇅")]),s[25]||(s[25]=l("hr",null,null,-1)),l("div",he,[(b(!0),g(T,null,P(c.value,(n,k)=>(b(),H(L,{card:n,close:!0,onClick:M=>c.value.splice(k,1),"pointer-events":e.value?"none":"auto"},null,8,["card","onClick","pointer-events"]))),256))]),l("details",{open:i.value},[s[24]||(s[24]=l("summary",null,[C(" CARD "),l("hr")],-1)),l("div",pe,[(b(!0),g(T,null,P(J(D),(n,k)=>(b(),H(L,{card:n,onClick:M=>c.value.push(new(J(F))(n.short)),"pointer-events":e.value?"none":"auto"},null,8,["card","onClick","pointer-events"]))),256))])],8,fe)],64)):N("",!0),l("form",null,[s[45]||(s[45]=l("h2",null,"STAGE",-1)),s[46]||(s[46]=l("hr",null,null,-1)),l("div",ce,[s[26]||(s[26]=l("label",{for:"qc"},"曲长: ",-1)),w(l("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>o.value.qc=n),type:"text",disabled:e.value,id:"qc"},null,8,ve),[[E,o.value.qc]]),s[27]||(s[27]=C(" s  ")),s[28]||(s[28]=l("label",{for:"qc"},"生化值: ",-1)),w(l("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>o.value.sh=n),type:"text",disabled:e.value,id:"sh"},null,8,be),[[E,o.value.sh]]),s[29]||(s[29]=C("   ")),s[30]||(s[30]=l("label",{for:"deckLength"},"卡组牌数: ",-1)),w(l("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>o.value.deckLength=n),type:"number",disabled:e.value,id:"deckLength"},null,8,ge),[[E,o.value.deckLength]]),s[31]||(s[31]=C("   ")),l("button",{onClick:s[4]||(s[4]=n=>{o.value.apSpeed=Number((1200/o.value.qc/o.value.sh*(1-.1*Math.min(9,18-o.value.deckLength))).toFixed(2)),o.value.cardTimes=Math.floor(o.value.qc*8/3)}),disabled:e.value}," 计算AP回复速度/暂停回数 ",8,ye)]),l("div",null,[s[32]||(s[32]=l("label",{for:"ap"},"AP回复速度: ",-1)),w(l("input",{"onUpdate:modelValue":s[5]||(s[5]=n=>o.value.apSpeed=n),type:"text",disabled:e.value,id:"ap"},null,8,ke),[[E,o.value.apSpeed]])]),l("div",null,[s[33]||(s[33]=l("label",{for:"card-time"},"暂停回数: ",-1)),w(l("input",{"onUpdate:modelValue":s[6]||(s[6]=n=>o.value.cardTimes=n),disabled:e.value,type:"number",id:"card-time"},null,8,Ce),[[E,o.value.cardTimes]])]),l("div",null,[s[34]||(s[34]=l("label",{for:"ap-max"},"最大AP: ",-1)),w(l("input",{"onUpdate:modelValue":s[7]||(s[7]=n=>o.value.apMax=n),disabled:e.value,type:"number",id:"ap-max"},null,8,we),[[E,o.value.apMax]])]),l("div",null,[s[36]||(s[36]=l("label",{for:"sp"},"SP: ",-1)),w(l("select",{"onUpdate:modelValue":s[8]||(s[8]=n=>o.value.sp=n),disabled:e.value,id:"sp",onChange:s[9]||(s[9]=n=>o.value.sp.includes("2")?o.value.strategy="score":o.value.strategy="cost")},s[35]||(s[35]=[Y('<option value="" data-v-e9008698>--</option><option value="tz" data-v-e9008698>舞会缀</option><option value="sy" data-v-e9008698>舞会沙耶</option><option value="tz2" data-v-e9008698>银河缀</option><option value="mg2" data-v-e9008698>银河慈</option>',5)]),40,Me),[[G,o.value.sp]])]),l("div",null,[s[38]||(s[38]=l("label",{for:"effect"},"效果: ",-1)),w(l("select",{"onUpdate:modelValue":s[10]||(s[10]=n=>o.value.effect=n),disabled:e.value,id:"effect"},s[37]||(s[37]=[Y('<option value="" data-v-e9008698>--</option><option value="st1a" data-v-e9008698> (2025/01 公会战A) skill6回使用 deck全card消费AP+1 </option><option value="kj1a" data-v-e9008698> (2025/01 个人战A) 山札切 AP3回复 main效果reshuffle效果deck全card消费AP+1 </option><option value="kj1b" data-v-e9008698> (2025/01 个人战B) skill5回使用 手札全捨 山札手札上限引直 </option><option value="gc1a" data-v-e9008698> (2025/01 GC A) skill30回使用 main效果mental回复deck全card消费APstage中常-1 </option><option value="gc1b" data-v-e9008698> (2025/01 GC B) skill15回使用 deck全スリブcard消费APstage中常-1 </option><option value="gc1c" data-v-e9008698> (2025/01 GC C) skill20回使用 deck全ドルケcard消费APstage中常-1 </option>',7)]),8,Ae),[[G,o.value.effect]])]),l("div",null,[s[40]||(s[40]=l("label",{for:"strategy"},"策略: ",-1)),w(l("select",{"onUpdate:modelValue":s[11]||(s[11]=n=>o.value.strategy=n),disabled:e.value,id:"strategy"},s[39]||(s[39]=[l("option",{value:"cost"},"LOVE/AP优先",-1),l("option",{value:"score"},"LOVE优先",-1)]),8,Se),[[G,o.value.strategy]])]),l("div",null,[s[41]||(s[41]=l("label",{for:"jewelry"},"LIVE TARGET💎: ",-1)),w(l("input",{"onUpdate:modelValue":s[12]||(s[12]=n=>o.value.jewelryCountTarget=n),type:"number",id:"jewelry",onChange:s[13]||(s[13]=n=>{e.value&&!t.value&&(d.value.jewelryCountTarget=o.value.jewelryCountTarget,d.value.testAllCards(),z())})},null,544),[[E,o.value.jewelryCountTarget]])]),l("div",null,[s[42]||(s[42]=l("label",{for:"jewelry"},"SKIP TARGET💎: ",-1)),w(l("input",{"onUpdate:modelValue":s[14]||(s[14]=n=>o.value.jewelryCountTargetMin=n),disabled:e.value,type:"number",id:"jewelry"},null,8,Te),[[E,o.value.jewelryCountTargetMin]]),s[43]||(s[43]=C(" ~ ")),w(l("input",{"onUpdate:modelValue":s[15]||(s[15]=n=>o.value.jewelryCountTargetMax=n),disabled:e.value,type:"number",id:"jewelry"},null,8,De),[[E,o.value.jewelryCountTargetMax]])]),l("div",null,[s[44]||(s[44]=l("label",{for:"skip-time"},"SKIP回数: ",-1)),w(l("input",{"onUpdate:modelValue":s[16]||(s[16]=n=>o.value.skipTimes=n),disabled:e.value,type:"number",id:"skip-time"},null,8,xe),[[E,o.value.skipTimes]])])]),l("div",je,[e.value&&!t.value?(b(),g("button",{key:0,onClick:s[17]||(s[17]=n=>{m.value={key:d.value.jewelryCountTarget,score:d.value.score,cardTimesDict:d.value.cardTimesDict},W(()=>u.value.showModal())})}," LOG ")):N("",!0),e.value?(b(),g("button",{key:1,onClick:U},"RETIRE")):(b(),g(T,{key:2},[a.value.length?(b(),g("button",{key:0,onClick:s[18]||(s[18]=n=>a.value=[])}," CLEAR RESULTS ")):N("",!0),l("button",{onClick:s[19]||(s[19]=n=>V(!0))},"SKIP"),l("button",{onClick:s[20]||(s[20]=n=>V(!1))},"LIVE START")],64))]),e.value&&!t.value?(b(),g(T,{key:1},[l("h2",Ee,[l("div",null,v(d.value.score),1),l("div",null,v(d.value.timesCount)+"回",1)]),l("h2",Fe,[l("div",null,v(d.value.sp=="mg2"?"∞":d.value.mental?"100%":"-%"),1),l("div",null,v(d.value.ignition?"🔥":"🚫")+" "+v(d.value.sp=="kz2"?"∞":d.value.ap),1)]),s[47]||(s[47]=l("div",{style:{"text-align":"right"}},null,-1)),l("h2",Ie,[l("div",null,"手札 "+v(d.value.te.length),1),l("button",{onClick:s[21]||(s[21]=n=>{d.value.useCard(void 0),z()})}," AP SKIP ")]),s[48]||(s[48]=l("hr",null,null,-1)),l("div",Pe,[(b(!0),g(T,null,P(d.value.te,(n,k)=>(b(),H(L,{card:n,stage:d.value,te:!0,class:le({highlight:$.value==k}),onClick:M=>{d.value.useCard(k),z()}},null,8,["card","stage","class","onClick"]))),256))]),l("h2",null,"捨札 "+v(d.value.sute.length),1),s[49]||(s[49]=l("hr",null,null,-1)),l("div",ze,[(b(!0),g(T,null,P(d.value.sute,(n,k)=>(b(),H(L,{card:n,stage:d.value,"pointer-events":"none"},null,8,["card","stage"]))),256))]),l("h2",null,"山札 "+v(d.value.yama.length),1),s[50]||(s[50]=l("hr",null,null,-1)),l("div",Ne,[(b(!0),g(T,null,P(d.value.yama,(n,k)=>(b(),H(L,{card:n,stage:d.value,"pointer-events":"none"},null,8,["card","stage"]))),256))])],64)):(b(!0),g(T,{key:2},P(a.value,(n,k)=>(b(),g("table",null,[l("thead",null,[l("tr",null,[l("td",Ve,v(n.deck),1)]),l("tr",null,[l("td",$e,"AP回复速度: "+v(n.formData.apSpeed),1),l("td",He,"暂停回数: "+v(n.formData.cardTimes),1),l("td",Le,"SKIP回数: "+v(n.formData.skipTimes),1)]),l("tr",null,[l("td",Re,"SP: "+v(n.formData.sp),1),l("td",Ue,"效果: "+v(n.formData.effect),1),l("td",Oe,"策略: "+v(n.formData.strategy),1)]),s[51]||(s[51]=l("tr",null,[l("td",null,[C("target"),l("br"),C("💎")]),l("td",null,[C("kol慈"),l("br"),C("回数")]),l("td",null,[C("💎"),l("br"),C("回数")]),l("td",null,[C("AP SKIP"),l("br"),C("回数")]),l("td",null,"heart"),l("td",null,"%")],-1))]),l("tbody",null,[(b(!0),g(T,null,P(n.dict,(M,S)=>(b(),g("tr",{style:{cursor:"pointer"},onClick:x=>{m.value={key:S,...M},W(()=>u.value.showModal())}},[l("td",null,v(S),1),l("td",null,v(M.cardTimesDict.kol慈??0),1),l("td",null,v(M.cardTimesDict["💎"]??0),1),l("td",null,v(M.cardTimesDict.apSkip),1),l("td",null,v(M.score),1),l("td",null,v(Number((M.score/Math.max(...Object.values(n.dict).map(x=>x.score))*100).toFixed(2))),1)],8,qe))),256))])]))),256)),m.value?(b(),g("dialog",{key:3,ref_key:"dialog",ref:u},[l("table",null,[l("thead",null,[l("tr",null,[s[52]||(s[52]=l("td",null,"target💎",-1)),l("td",null,v(m.value.key),1)]),l("tr",null,[s[53]||(s[53]=l("td",null,"heart",-1)),l("td",null,v(m.value.score),1)])]),l("tbody",null,[(b(!0),g(T,null,P(m.value.cardTimesDict,(n,k)=>(b(),g("tr",null,[l("td",null,v(k),1),l("td",null,v(n)+"回",1)]))),256))]),l("tfoot",null,[l("tr",null,[l("td",Ge,[l("button",{onClick:s[22]||(s[22]=n=>m.value=void 0)},"关闭")])])])])],512)):N("",!0)]))}},Je=te(Ke,[["__scopeId","data-v-e9008698"]]);export{Je as default};
