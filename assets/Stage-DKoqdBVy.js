import{_ as se,o as f,c,a as s,n as K,t as h,e as V,f as A,F as S,g as F,d as D,u as X,h as T,v as P,i as L,j as ae,k as N,l as oe,m as ne}from"./index-CnWZzuIZ.js";class j{constructor(e){this.short=e,this.props={short:e};let r=B.find(l=>l.short==e);if(r){this.props=r,this.member=r.member;let l=ue.find(d=>d.member==r.member);l&&(this.year=l.year,this.unit=l.unit),this.cost=r.cost,this.teCostDelta=0}}copy(){let e=new j(this.short);return e.cost=this.cost,e.teCostDelta=this.teCostDelta,e}getMain(e){var r;return(r=this.props)!=null&&r.main?typeof this.props.main=="function"?this.props.main(e):this.props.main:""}getCost(e=!1){var l,d;let r=this.cost;return e&&((l=this.props)!=null&&l.teCostDelta)&&(r+=(d=this.props)==null?void 0:d.teCostDelta(e)),e&&(r+=this.teCostDelta),r>=1?r:1}isReshuffle(e){var r;return(r=this.props)!=null&&r.reshuffle?typeof this.props.reshuffle=="function"?this.props.reshuffle(e):this.props.reshuffle:!1}onSkill(e){var r;(r=this.props)!=null&&r.skill&&(typeof this.props.skill=="function"?e.trigger(this.props.skill(e)):e.trigger(this.props.skill))}afterSkill(e){var r;(r=this.props)!=null&&r.afterSkill&&this.props.afterSkill(e)}onDraw(e){var r;this.teCostDelta=0,(r=this.props)!=null&&r.draw&&(typeof this.props.draw=="function"?e.trigger(this.props.draw(e,this)):e.trigger(this.props.draw))}calcDrawHeartCount(e){var d,u,m,a;let r=0,l;return(d=this.props)!=null&&d.draw&&(typeof((u=this.props)==null?void 0:u.draw)=="function"?l=(m=this.props)==null?void 0:m.draw(e):l=(a=this.props)==null?void 0:a.draw),r+=(l==null?void 0:l.heart)||0,e.sp=="tz"&&(r+=(l==null?void 0:l.voltage)||0),e.sp=="mg2"&&(r+=((l==null?void 0:l.mental)||0)+((l==null?void 0:l.protect)||0)),r}onCross(e,r){var l;(l=this.props)!=null&&l.cross&&this.props.cross(e,r,this)}matchAttrs(e){return Object.keys(e).every(r=>e[r]==null?!0:e[r]==this[r])}calcSubtractAp(e){let r=0;if(e!=null&&e.length)for(let l of e)this.matchAttrs({...l,cost:void 0})&&(r+=l.cost);return r}}const ue=[{member:3,short:"kz",year:102,unit:"srb"},{member:4,short:"tz",year:102,unit:"drk"},{member:6,short:"mg",year:102,unit:"mrp"},{member:1,short:"kh",year:103,unit:"srb"},{member:2,short:"sy",year:103,unit:"drk"},{member:5,short:"rr",year:103,unit:"mrp"},{member:7,short:"gn",year:104,unit:"srb"},{member:8,short:"sz",year:104,unit:"drk"},{member:9,short:"hm",year:104,unit:"mrp"}],B=[{short:"圣夜吟",member:7,cost:8,main:"dress",reshuffle:!0,skill:{cards:["圣夜👗","圣夜👗","圣夜👗","圣夜👗","圣夜👗"]}},{short:"圣夜👗",member:"dress",cost:3,main:"reshuffle",reshuffle:!0,once:!0,skill:{mental:1,voltage:1}},{short:"pa吟",member:7,cost:4,main:"dress",skill:{cards:["pa吟👗","pa吟👗"]}},{short:"pa吟👗",member:"dress",cost:2,main:"ap",once:!0},{short:"lttf铃",member:8,cost:9,main:"voltage",skill:{voltage:1,mental:-1},drawFilters:[{member:9}]},{short:"上升姬芽",member:9,cost:3,main(t){return t!=null&&t.ignition?"reshuffle":"mental"},reshuffle:t=>t==null?void 0:t.ignition,skill:{mental:1,protect:1},afterSkill(t){t.ignition&&(t.timesDict[this.short]==null?t.timesDict[this.short]=0:t.timesDict[this.short]++,t.timesDict[this.short]>=3&&(t.ignition=!1,t.timesDict[this.short]=void 0),t.trigger({"ap-":[{unit:"mrp",cost:-3}]}))},cross(t,e){if(!t.ignition){let r=e.getMain(t);(r=="mental"||r=="protect")&&(t.ignition=!0)}}},{short:"pa姬芽",member:9,cost:4,main:"reshuffle",reshuffle:!0,skill:{protect:1}},{short:"织姬花帆",member:1,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1}},{short:"音击花帆",member:1,cost:9,main:"heart",reshuffle:!0,yamaReshuffle:!0,skill:{heart:3},draw:{heart:1,mental:1}},{short:"lttf沙耶",member:2,cost:5,main:"voltage",skill:{voltage:1},drawFilters:[{member:6}]},{short:"沏茶瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{voltage:1},draw:{heart:1}},{short:"蛋糕瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{heart:1},draw:{heart:1}},{short:"花结梢",member:3,cost:13,main:"reshuffle",reshuffle:!0,drawFilters:[{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"}],cross(t,e,r){e.unit=="srb"&&(t.trigger({heart:1}),r.teCostDelta-=3)},afterSkill(t){t.getAllCards().forEach(e=>{(e.unit=="srb"||e.member=="dress")&&(e.cost-=3)})}},{short:"kol梢",member:3,cost:9,main:"mental",skill:{mental:1,heart:1},draw:{"ap-":[{member:6,cost:-9}]},cross(t,e){e.member==6&&t.trigger({protect:1,heart:1})}},{short:"自由缀",member:4,cost:2,main:"mental",skill:{mental:1,heart:1},draw:t=>{let e={};return t.mental&&(e={heart:1}),e}},{short:"kol缀",member:4,cost:3,main:"voltage",skill:{voltage:1,heart:1},draw:{"ap-":[{member:3,cost:-3},{member:6,cost:-3}]},cross(t,e){e.member==6&&t.trigger({voltage:1,heart:1})}},{short:"hsct慈",member:6,cost:4,main:"reshuffle",reshuffle:!0},{short:"kol慈",member:6,cost:39,main:"heart",skill:{heart:2,cards:["💎"]},cross(t,e,r){(e.member==1||e.member==2||e.member==3||e.member==4||e.member==5||e.member==7||e.member==8||e.member==9)&&(r.teCostDelta-=3)}},{short:"💎",member:"jewelry",cost:1,main:"ap-",once:!0,skill:{"ap-":[{cost:-1}]},draw:{heart:1,voltage:1,protect:1}},{short:"舞会缀",member:4,cost:2,main:"voltage",skill:{voltage:1}},{short:"舞会沙耶",member:2,cost:2,main:"love+"},{short:"银河缀",member:4,cost:2,main:"voltage",skill:{voltage:1,heart:1},afterSkill(t){t.sp=="tz2"&&t.trigger({ap:5})}},{short:"银河慈",member:6,cost:5,main:"reshuffle",reshuffle:!0,skill:{mental:2,protect:1},afterSkill(t){t.sp=="mg2"&&t.trigger({ap:20})}},{short:"讴歌梢",member:3,cost:3,main:"love+",draw:{heart:1}},{short:"ritm梢",member:3,cost:2,main:"voltage",skill:{voltage:1},draw:{mental:1}},{short:"秋色梢",member:3,cost:6,main:"love+",draw:{mental:1}},{short:"自由梢",member:3,cost:2,main:"protect",skill:{protect:1},draw:t=>{let e={};return t.mental&&(e={protect:1}),e}},{short:"教师梢",member:3,cost:2,main:"heart",skill:{heart:1,mental:-1},draw:{mental:1}},{short:"ss缀",member:4,cost:3,main:"heart",skill:{heart:1},draw:{voltage:1}},{short:"雨伞缀",member:4,cost:5,main:"love+",draw:{heart:1}},{short:"花火缀",member:4,cost:3,main:"voltage",skill:{voltage:1},draw:{voltage:1}},{short:"秋色缀",member:4,cost:6,main:"heart",skill:t=>{let e={};return t.mental?e={heart:3}:e={heart:2},e},draw:{mental:1}},{short:"抱花缀",member:4,cost:4,main:"voltage",skill:{voltage:1},draw:{voltage:1}},{short:"音击缀",member:4,cost:9,main:"voltage",skill:{voltage:1,heart:3},draw:{voltage:1,protect:1}},{short:"蛋糕慈",member:6,cost:4,main:"mental",skill:{mental:1},draw:{mental:1,protect:1}},{short:"舞会慈",member:6,cost:3,main:"love+",yamaUse:!0,skill:{mental:-1},draw:{mental:1}},{short:"圣诞慈",member:6,cost:4,main:"mental",skill:{mental:3},draw:{mental:1}},{short:"抱花慈",member:6,cost:4,main:"protect",skill:{protect:1},draw:{protect:1}},{short:"ritm花帆",member:1,cost:1,main:"heart",skill:{heart:1},draw:{mental:1}},{short:"讴歌花帆",member:1,cost:3,main:"mental",skill:{mental:1},draw:{voltage:1}},{short:"雨伞花帆",member:1,cost:3,main:"voltage",skill:{voltage:1},draw:{mental:1}},{short:"自由花帆",member:1,cost:2,main:"voltage",skill:{voltage:1,heart:1},draw:t=>{let e={};return t.mental&&(e={voltage:1}),e}},{short:"偶活花帆",member:1,cost:9,main:"heart",reshuffle:!0,skill:{heart:1},cross(t,e,r){(e.member==2||e.member==5)&&(r.teCostDelta-=2)}},{short:"快乐花帆",member:1,cost:2,main:"mental",skill:{mental:1,voltage:1},draw:{mental:1,heart:1}},{short:"雨伞沙耶",member:2,cost:4,main:"mental",skill:{mental:1},draw:{voltage:1}},{short:"tc沙耶",member:2,cost:3,main:"love+",skill:{mental:-1},draw:{voltage:1}},{short:"宇宙沙耶",member:2,cost:4,main:"teMax",skill:{voltage:1}},{short:"沏茶沙耶",member:2,cost:2,main:"love+",skill:{voltage:1}},{short:"圣诞沙耶",member:2,cost:4,main:"voltage",skill:{voltage:1,heart:2},draw:{voltage:1}},{short:"db瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{voltage:1},draw:{voltage:1}},{short:"梦境瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{heart:1}},{short:"rod瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1},draw:{mental:1}},{short:"一专瑠璃",member:5,cost:5,main:"reshuffle",reshuffle:!0,skill:{heart:1}},{short:"abdl瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1}},{short:"白昼瑠璃",member:5,cost:3,main:"reshuffle",reshuffle:!0,skill:{mental:-1},draw:{heart:1}},{short:"mc瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,afterSkill(t){t.ignition?t.trigger({heart:1}):t.trigger({ap:1})}},{short:"ritm吟",member:7,cost:5,main:"dress",skill:{cards:["ritm👗1","ritm👗2","ritm👗3"]},draw:{protect:1}},{short:"ritm👗1",member:"dress",cost:1,main:"heart",once:!0,skill:{heart:1}},{short:"ritm👗2",member:"dress",cost:1,main:"voltage",once:!0,skill:{voltage:1}},{short:"ritm👗3",member:"dress",cost:1,main:"teMax",once:!0},{short:"蓝远吟",member:7,cost:3,main:"dress",skill:{cards:["蓝远👗","蓝远👗","蓝远👗"]},cross(t,e){e.unit=="srb"&&t.trigger({voltage:1})}},{short:"蓝远👗",member:"dress",cost:2,main:"reshuffle",reshuffle:!0,once:!0,skill:{heart:1}},{short:"花结吟",member:7,cost:13,teCostDelta(t){let e=0;for(let r of t)r.unit=="srb"&&(e-=3);return e},main:"dress",reshuffle:!0,skill:{cards:["花结👗1","花结👗1","花结👗1","花结👗2","花结👗2","花结👗2","花结👖3","花结👖3","花结👖3"]},drawFilters:[{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"}]},{short:"花结👗1",member:"dress",cost:3,main:"voltage",once:!0,skill(t){let e={voltage:2};return t.getAllCards().length>=33&&(t.sp=="tz2"?e.heart=1:e.heart=2),e}},{short:"花结👗2",member:"dress",cost:3,main:"protect",once:!0,skill(t){let e={protect:1};return t.getAllCards().length>=33&&(t.sp=="mg2"?e.heart=1:e.heart=2),e}},{short:"花结👖3",member:"dress",cost:3,main:"reshuffle",reshuffle:!0,once:!0,skill(t){if(t.getAllCards().length>=30)return{heart:2}},drawFilters:[{unit:"srb"},{unit:"srb"},{unit:"srb"},{unit:"srb"},{unit:"srb"},{unit:"srb"}]},{short:"雪纺铃",member:8,cost:3,main:"mental",skill:{mental:1}},{short:"af缀",member:4,cost:9,main:"voltage",skill(t){let e={voltage:2,heart:10,ap:-20};return t.sp=="tz"&&(e.heart=9),e},afterSkill(t){t.sp=="tz2"&&t.trigger({ap:20})}},{short:"af慈",member:6,cost:9,main:"protect",skill(t){let e={protect:1,heart:10,ap:-20};return t.sp=="mg2"&&(e.heart=9),e},afterSkill(t){t.sp=="mg2"&&t.trigger({ap:15})}}];let le=class ie{constructor(e){this.score=0,this.te=[],this.sute=[],this.yama=e,this.mental=!0,this.protect=!1,this.apMax=20,this.ignition=!1,this.timesDict={},this.cardTimesDict={apSkip:0},this.timesCount=0,this.cardsCount=0,this.sp="",this.effect="",this.teMax=8,this.ap=8,this.apSpeed=2.5,this.drawHeartCount=0,this.jewelryCountTarget=0,this.testResults=[]}getAllCards(){return[...this.te,...this.sute,...this.yama]}getDrawYama(){return this.yama.length?this.yama:this.sute}start(){this.sp=="kz2"&&(this.ap=1/0);for(let e=0;e<this.teMax;e++){let r=Math.floor(Math.random()*this.yama.length),l=this.yama.splice(r,1)[0];this.te.push(l)}this.testAllCards()}draw(e,r){this.yama.length||(this.yama=[...this.sute],this.sute=[],this.effect=="kj1a"&&this.yama.forEach(m=>{m.getMain(this)=="reshuffle"&&m.cost++}));let l;r?(l=this.yama.filter(m=>m.matchAttrs(r)),l.length||(l=this.yama)):l=this.yama;let d=Math.floor(Math.random()*l.length),u=l[d];this.yama.splice(this.yama.indexOf(u),1),this.te[e]=u,u.onDraw(this)}autoAp(){this.sp!="kz2"&&this.addAp(this.apSpeed)}useCard(e){var d,u,m,a,v,M,g;if(e==null){this.cardTimesDict.apSkip++,this.autoAp(),this.timesCount++;return}let r=this.te[e];this.cardTimesDict[r.short]||(this.cardTimesDict[r.short]=0),this.cardTimesDict[r.short]++;let l=r.isReshuffle(this);r.onSkill(this);for(let n of this.te)n.onCross(this,r);if(this.sp=="sy"&&this.score++,l){for(let n in this.te)n!=e&&this.sute.push(this.te[n]);(d=r.props)!=null&&d.yamaReshuffle&&this.yama.push(...this.sute.splice(0));for(let n=0;n<this.teMax;n++)this.draw(n,(m=(u=r.props)==null?void 0:u.drawFilters)==null?void 0:m[n])}else this.draw(e,(v=(a=r.props)==null?void 0:a.drawFilters)==null?void 0:v[0]);if((M=r.props)!=null&&M.once||((g=r.props)!=null&&g.yamaUse?this.yama.push(r):this.sute.push(r)),this.sp!="kz2"&&(this.addAp(-r.getCost(this.te)),this.autoAp()),r.cost=r.props.cost,r.afterSkill(this),this.timesCount++,this.cardsCount++,this.effect=="kj1b"&&this.cardsCount%5==0){this.sute.push(...this.te.splice(0));for(let n=0;n<this.teMax;n++)this.draw(n)}this.effect=="st1a"&&this.cardsCount%6==0&&this.getAllCards().forEach(n=>n.cost++),!this.protect&&this.sp!="mg2"&&(this.mental=!1),this.testAllCards()}calcTestDrawHeartCount(){let e=0,r=this.getAllCards(),l=r.filter(d=>d.short=="💎").length;if(l<this.jewelryCountTarget)for(let d=0;d<this.jewelryCountTarget-l;d++)r.push(new j("💎"));return r.forEach(d=>{e+=d.calcDrawHeartCount(this)}),this.drawHeartCount=e,e}testCard(e,r){var M,g,n,z,U,$,q,I,E,p,i,o,b,k,y,C,w,Y,W;let l=new ie([]);for(let x of this.te)l.te.push(x.copy());for(let x of this.sute)l.sute.push(x.copy());for(let x of this.yama)l.yama.push(x.copy());l.mental=this.mental,l.protect=this.protect,l.ap=this.ap,l.apMax=this.apMax,l.apSpeed=this.apSpeed,l.ignition=this.ignition,l.timesDict=this.timesDict,l.sp=this.sp,l.jewelryCountTarget=this.jewelryCountTarget;let d,u;if(r&&(d=l.te[e].getCost(l.te),l.te[e]=r,u=l.te[e].getCost(l.te),u>l.apMax))return 0;let m=l.te[e],a=m.isReshuffle(l);m.onSkill(l);for(let x of l.te)x.onCross(l,m);l.calcTestDrawHeartCount();let v=l.score;if(a&&(v+=l.drawHeartCount*this.teMax/(l.getAllCards().length+(((n=(g=(M=m.props)==null?void 0:M.skill)==null?void 0:g.cards)==null?void 0:n.length)??0))),((U=(z=m.props)==null?void 0:z.drawFilters)==null?void 0:U.length)==1&&!r){let x=($=m.props)==null?void 0:$.drawFilters[0],J=l.getDrawYama().filter(O=>Object.keys(x).every(Q=>O[Q]==x[Q]));J.forEach(O=>v+=l.testCard(e,O)/J.length)}return(E=(I=(q=m.props)==null?void 0:q.skill)==null?void 0:I.cards)!=null&&E.length&&(v/=((o=(i=(p=m.props)==null?void 0:p.skill)==null?void 0:i.cards)==null?void 0:o.length)+1),m.short=="上升姬芽"&&(v*=3/4),r&&(v/=(d+u)*d),(b=m.props)!=null&&b.once&&(v+=((l.drawHeartCount-m.calcDrawHeartCount(l))/(l.getAllCards().length-1)-l.drawHeartCount/l.getAllCards().length)*this.teMax**2),(C=(y=(k=m.props)==null?void 0:k.skill)==null?void 0:y.cards)!=null&&C.length&&(v+=(l.drawHeartCount/(l.getAllCards().length+((W=(Y=(w=m.props)==null?void 0:w.skill)==null?void 0:Y.cards)==null?void 0:W.length))-l.drawHeartCount/l.getAllCards().length)*this.teMax**2),v<0?0:v}testAllCards(){this.testResults=this.te.map((e,r)=>this.testCard(r))}trigger(e){e&&(this.addAp(e.ap),this.addHeart(e.heart),this.addVoltage(e.voltage),this.addMental(e.mental),this.addProtect(e.protect),this.subtractAp(e["ap-"]),this.addCard(e.cards))}addHeart(e){e&&(this.score+=e)}addVoltage(e){e&&this.sp=="tz"&&(this.score+=e,this.addAp(1*e))}addMental(e){e&&(e>0&&this.sp=="mg2"&&(this.score+=e,this.addAp(1*e)),e>0?this.mental=!0:e<0&&this.sp!="mg2"&&(this.mental=!1))}addProtect(e){e&&(this.sp=="mg2"&&(this.score+=e,this.addAp(2*e)),this.protect=!0)}subtractAp(e){if(e!=null&&e.length)for(let r of this.getAllCards())r.cost+=r.calcSubtractAp(e)}addCard(e){if(e!=null&&e.length)for(let r of e)this.yama.push(new j(r))}addAp(e){if(e){let r=this.ap+e;r>this.apMax&&(r=this.apMax),r<0&&(r=0),this.ap=Number(r.toFixed(2))}}};const me={class:"cost"},de={key:0,class:"close"},he={key:1,class:"test"},fe={key:2,class:"time"},pe={__name:"Card",props:{card:{type:j},stage:{type:le},te:{default:!1},close:{default:!1},pointerEvents:{default:"auto"}},setup(t){const e=t,r={heart:"rgb(204,39,39)","love+":"rgb(174,141,24)",voltage:"rgb(174,141,24)",mental:"rgb(48,124,24)",reshuffle:"rgb(134,82,195)",teMax:"rgb(134,82,195)",protect:"rgb(48,124,24)",dress:"rgb(134,82,195)",ap:"rgb(174,141,24)","ap-":"rgb(134,82,195)","":"transparent"},l={1:"#f8b500",2:"#5383c3",3:"#68be8d",4:"#ba2636",5:"#e7609e",6:"#c8c2c6",7:"#a2d7dd",8:"#fad764",9:"#9d8de2"};return(d,u)=>{var m,a;return f(),c("div",{class:"card",style:K({pointerEvents:t.te&&e.card.getCost(t.te?e.stage.te:void 0)>e.stage.ap?"none":e.pointerEvents})},[s("div",{class:"background",style:K({backgroundColor:l[e.card.member]?`${l[e.card.member]}`:"transparent"})},null,4),s("div",{style:K({fontWeight:e.card.isReshuffle(e.stage)?"bold":"",fontStyle:e.card.isReshuffle(e.stage)?"italic":""})},h(e.card.short),5),s("div",me,h(e.card.getCost(t.te?e.stage.te:void 0)),1),s("div",{class:"main",style:K({backgroundColor:r[e.card.getMain(e.stage)]})},null,4),e.close?(f(),c("div",de,"×")):V("",!0),e.te?(f(),c("div",he,h(Number(e.stage.testResults[e.stage.te.indexOf(e.card)].toFixed(2))),1)):V("",!0),((m=e.stage)==null?void 0:m.timesDict[e.card.short])!=null?(f(),c("div",fe,h((a=e.stage)==null?void 0:a.timesDict[e.card.short]),1)):V("",!0)],4)}}},R=se(pe,[["__scopeId","data-v-5394f316"]]);function H(t){let e=[];for(let r=0;r<t.te.length;r++)t.te[r].getCost(t.te)<=t.ap&&e.push(r);return e}function Z(t,e){let r=e.map(d=>t.testResults[d]),l=Math.max(...r);return e.filter((d,u)=>r[u]==l)}function _(t,e,r){let l=t.te.map((m,a)=>t.testResults[a]/t.te[a].getCost(t.te)),d=e.map(m=>l[m]),u=Math.max(...d);if(!r&&u==0&&Math.max(...l)>0){let m=Math.min(...e.map(a=>t.te[a].getCost(t.te)));return m<=t.apSpeed?e.filter(a=>t.te[a].getCost(t.te)==m):[]}else return e.filter((m,a)=>d[a]==u)}function ce(t,e){let r=e.map(d=>{let u=t.te[d],m=0;return t.getAllCards().forEach(a=>{var v,M,g,n;(M=(v=a.props)==null?void 0:v.draw)!=null&&M["ap-"]&&(m+=u.calcSubtractAp((n=(g=a.props)==null?void 0:g.draw)==null?void 0:n["ap-"]))}),m}),l=Math.min(...r);return e.filter((d,u)=>r[u]==l)}function ee(t,e){let r=e.filter(l=>{var d,u;return(u=(d=t.te[l].props)==null?void 0:d.drawFilters)==null?void 0:u.length});return r.length?r:e}function te(t,e){let r=e.filter(l=>t.te[l].member=="dress");return r.length?r:e}function re(t,e,r){if(t.getAllCards().filter(u=>u.member=="jewelry").length>e)return r;let d=r.filter(u=>t.te[u].member!="jewelry");return d.length?d:r}function G(t,e=8,r){let l,d;if(r==null&&(r=t.strategy??(t.sp=="mg2"||t.sp=="tz2"||t.sp=="kz2"?"score":"cost"),t.ap+t.apSpeed>=t.apMax&&(r="score")),!t.ignition&&t.te.find(u=>u.short=="上升姬芽")&&t.te.find(u=>(u.getMain(t)=="mental"||u.getMain(t)=="protect")&&u.short!="上升姬芽")&&(r=="score"?l=Z(t,H(t).filter(u=>{let m=t.te[u];return(m.getMain(t)=="mental"||m.getMain(t)=="protect")&&m.short!="上升姬芽"}))[0]:l=_(t,H(t).filter(u=>{let m=t.te[u];return(m.getMain(t)=="mental"||m.getMain(t)=="protect")&&m.short!="上升姬芽"}),!0)[0]),l==null&&(d=t.te.findIndex(u=>u.short=="kol慈"),d>=0&&t.getAllCards().filter(u=>u.member=="jewelry").length<e&&t.te[d].getCost(t.te)<(r=="score"?t.ap:t.ap+Math.min(0,t.apSpeed-4))&&(l=d)),l==null&&(d=t.te.findIndex(u=>u.member=="jewelry"&&u.getCost(t.te)==2),d>=0&&t.getAllCards().filter(u=>u.member=="jewelry").length>e&&(l=d)),l==null&&(r=="score"?l=ee(t,re(t,e,Z(t,te(t,H(t)))))[0]:l=ce(t,ee(t,re(t,e,_(t,te(t,H(t))))))[0]),H(t).length&&l==null)debugger;return l}window.strategyPlay=G;const ve={class:"grid"},be=["open"],ge={class:"grid"},ke={style:{"font-size":"small"}},ye=["disabled"],Ce=["disabled"],we=["disabled"],Se=["disabled"],De=["disabled"],Ae=["disabled"],Te=["disabled"],Me=["disabled"],xe=["disabled"],je=["disabled"],Fe=["disabled"],Pe={style:{"text-align":"right"}},ze={class:"flex-between"},Ee={class:"flex-between"},Ve={class:"flex-between"},$e={class:"grid"},Ie={class:"grid"},Ne={class:"grid"},Re={colspan:"6"},He={colspan:"2"},Ue={colspan:"2"},qe={colspan:"2"},Ke={colspan:"2"},Oe={colspan:"2"},Le={colspan:"2"},Be=["onClick"],Ge={colspan:"2",style:{"text-align":"center"}},Ye={__name:"Stage",setup(t){const e=A(!1),r=A(!1),l=A([]),d=A(!1),u=A(),m=A(),a=A({qc:140,sh:3.3,apSpeed:2.6,sp:"",effect:"",jewelryCountTargetMin:0,jewelryCountTargetMax:20,cardTimes:373,skipTimes:100,strategy:"cost"}),v=A(10),M=B.map(p=>new j(p.short)).sort((p,i)=>typeof p.member=="number"&&typeof i.member=="number"?p.member-i.member:typeof p.member=="number"&&typeof i.member!="number"?-1:typeof p.member!="number"&&typeof i.member=="number"||p.member>i.member?1:p.member<i.member?-1:0),g=A(B.filter(p=>typeof p.member=="number").map(p=>new j(p.short)).slice(0,16)),n=A();window.getStage=()=>n.value;const z=()=>{n.value=new le([]),n.value.apSpeed=Number(a.value.apSpeed),n.value.sp=a.value.sp,n.value.effect=a.value.effect,n.value.strategy=a.value.strategy,n.value.yama=g.value.map(p=>new j(p.short))};z();const U=()=>{e.value=!1,z()},$=async p=>{var i;if(d.value=!1,e.value=!0,r.value=p,p){l.value.push({deck:g.value.map(o=>o.short).join(", "),formData:{...a.value},dict:{}});for(let o=Number(a.value.jewelryCountTargetMin);o<=Number(a.value.jewelryCountTargetMax)&&e.value;o++){let b=0,k=0,y={apSkip:0};for(let C of g.value)y[C.short]=0;for(let C=0;C<Number(a.value.skipTimes);C++){await q(),z(),n.value.jewelryCountTarget=o,n.value.start();for(let w=0;w<Number(a.value.cardTimes)&&e.value;w++)n.value.useCard(G(n.value,o));if(!e.value)break;b+=n.value.score,k+=(i=n.value.getAllCards().filter(w=>w.member=="jewelry"))==null?void 0:i.length;for(let w in n.value.cardTimesDict)y[w]||(y[w]=0),y[w]+=n.value.cardTimesDict[w]}if(!e.value)break;for(let C in y)y[C]=Number((y[C]/a.value.skipTimes).toFixed(2));l.value.at(-1).dict[o]={score:Number((b/a.value.skipTimes).toFixed(2)),jewelryCount:Number((k/a.value.skipTimes).toFixed(2)),cardTimesDict:y}}e.value=!1}else z(),n.value.jewelryCountTarget=v.value,n.value.start(),E()},q=async p=>new Promise(i=>setTimeout(i,p)),I=A(-1),E=()=>{I.value=G(n.value,v.value)};return(p,i)=>(f(),c("div",null,[!e.value||r.value?(f(),c(S,{key:0},[i[20]||(i[20]=s("h2",null,"DECK",-1)),i[21]||(i[21]=s("hr",null,null,-1)),s("div",ve,[(f(!0),c(S,null,F(g.value,(o,b)=>(f(),N(R,{card:o,close:!0,onClick:k=>g.value.splice(b,1),"pointer-events":e.value?"none":"auto"},null,8,["card","onClick","pointer-events"]))),256))]),s("details",{open:d.value},[i[19]||(i[19]=s("summary",null,[D(" CARD "),s("hr")],-1)),s("div",ge,[(f(!0),c(S,null,F(X(M),(o,b)=>(f(),N(R,{card:o,onClick:k=>g.value.push(new(X(j))(o.short)),"pointer-events":e.value?"none":"auto"},null,8,["card","onClick","pointer-events"]))),256))])],8,be)],64)):V("",!0),s("form",null,[i[38]||(i[38]=s("h2",null,"STAGE",-1)),i[39]||(i[39]=s("hr",null,null,-1)),s("div",ke,[i[22]||(i[22]=s("label",{for:"qc"},"曲长: ",-1)),T(s("input",{"onUpdate:modelValue":i[0]||(i[0]=o=>a.value.qc=o),type:"text",disabled:e.value,id:"qc"},null,8,ye),[[P,a.value.qc]]),i[23]||(i[23]=D(" s  ")),i[24]||(i[24]=s("label",{for:"qc"},"生化值: ",-1)),T(s("input",{"onUpdate:modelValue":i[1]||(i[1]=o=>a.value.sh=o),type:"text",disabled:e.value,id:"sh"},null,8,Ce),[[P,a.value.sh]]),i[25]||(i[25]=D("   ")),s("button",{onClick:i[2]||(i[2]=o=>{a.value.apSpeed=Number((1200/a.value.qc/a.value.sh).toFixed(2)),a.value.cardTimes=Math.floor(a.value.qc*8/3)}),disabled:e.value}," 计算AP回复速度/暂停回数 ",8,we)]),s("div",null,[i[26]||(i[26]=s("label",{for:"ap"},"AP回复速度: ",-1)),T(s("input",{"onUpdate:modelValue":i[3]||(i[3]=o=>a.value.apSpeed=o),type:"text",disabled:e.value,id:"ap"},null,8,Se),[[P,a.value.apSpeed]])]),s("div",null,[i[27]||(i[27]=s("label",{for:"card-time"},"暂停回数: ",-1)),T(s("input",{"onUpdate:modelValue":i[4]||(i[4]=o=>a.value.cardTimes=o),disabled:e.value,type:"number",id:"card-time"},null,8,De),[[P,a.value.cardTimes]])]),s("div",null,[i[29]||(i[29]=s("label",{for:"sp"},"SP: ",-1)),T(s("select",{"onUpdate:modelValue":i[5]||(i[5]=o=>a.value.sp=o),disabled:e.value,id:"sp",onChange:i[6]||(i[6]=o=>a.value.sp.includes("2")?a.value.strategy="score":a.value.strategy="cost")},i[28]||(i[28]=[ae('<option value="" data-v-493d34e8>--</option><option value="tz" data-v-493d34e8>舞会缀</option><option value="sy" data-v-493d34e8>舞会沙耶</option><option value="tz2" data-v-493d34e8>银河缀</option><option value="mg2" data-v-493d34e8>银河慈</option>',5)]),40,Ae),[[L,a.value.sp]])]),s("div",null,[i[31]||(i[31]=s("label",{for:"effect"},"效果: ",-1)),T(s("select",{"onUpdate:modelValue":i[7]||(i[7]=o=>a.value.effect=o),disabled:e.value,id:"effect"},i[30]||(i[30]=[s("option",{value:""},"--",-1),s("option",{value:"st1a"}," (2025年1月公会战A) skill6回使用 deck全card消费AP+1 ",-1),s("option",{value:"kj1a"}," (2025年1月个人战A) 山札切 main效果reshuffle效果deck全card消费AP+1 ",-1),s("option",{value:"kj1b"}," (2025年1月个人战B) skill5回使用 手札全捨 山札手札上限引直 ",-1)]),8,Te),[[L,a.value.effect]])]),s("div",null,[i[33]||(i[33]=s("label",{for:"strategy"},"策略: ",-1)),T(s("select",{"onUpdate:modelValue":i[8]||(i[8]=o=>a.value.strategy=o),disabled:e.value,id:"strategy"},i[32]||(i[32]=[s("option",{value:"cost"},"pt/AP优先",-1),s("option",{value:"score"},"pt优先",-1)]),8,Me),[[L,a.value.strategy]])]),s("div",null,[i[34]||(i[34]=s("label",{for:"jewelry"},"LIVE TARGET💎: ",-1)),T(s("input",{"onUpdate:modelValue":i[9]||(i[9]=o=>v.value=o),type:"number",id:"jewelry",onChange:i[10]||(i[10]=o=>{e.value&&!r.value&&(n.value.jewelryCountTarget=v.value,n.value.testAllCards(),E())})},null,544),[[P,v.value]])]),s("div",null,[i[35]||(i[35]=s("label",{for:"jewelry"},"SKIP TARGET💎: ",-1)),T(s("input",{"onUpdate:modelValue":i[11]||(i[11]=o=>a.value.jewelryCountTargetMin=o),disabled:e.value,type:"number",id:"jewelry"},null,8,xe),[[P,a.value.jewelryCountTargetMin]]),i[36]||(i[36]=D(" ~ ")),T(s("input",{"onUpdate:modelValue":i[12]||(i[12]=o=>a.value.jewelryCountTargetMax=o),disabled:e.value,type:"number",id:"jewelry"},null,8,je),[[P,a.value.jewelryCountTargetMax]])]),s("div",null,[i[37]||(i[37]=s("label",{for:"skip-time"},"SKIP回数: ",-1)),T(s("input",{"onUpdate:modelValue":i[13]||(i[13]=o=>a.value.skipTimes=o),disabled:e.value,type:"number",id:"skip-time"},null,8,Fe),[[P,a.value.skipTimes]])])]),s("div",Pe,[e.value?(f(),c("button",{key:0,onClick:U},"RETIRE")):(f(),c(S,{key:1},[l.value.length?(f(),c("button",{key:0,onClick:i[14]||(i[14]=o=>l.value=[])}," CLEAR RESULTS ")):V("",!0),s("button",{onClick:i[15]||(i[15]=o=>$(!0))},"SKIP"),s("button",{onClick:i[16]||(i[16]=o=>$(!1))},"LIVE START")],64))]),e.value&&!r.value?(f(),c(S,{key:1},[s("h2",ze,[s("div",null,h(n.value.score),1),s("div",null,h(n.value.timesCount)+"回",1)]),s("h2",Ee,[s("div",null,h(n.value.sp=="mg2"?"∞":n.value.mental?"100%":"-%"),1),s("div",null,h(n.value.ignition?"🔥":"🚫")+" "+h(n.value.sp=="kz2"?"∞":n.value.ap),1)]),i[40]||(i[40]=s("div",{style:{"text-align":"right"}},null,-1)),s("h2",Ve,[s("div",null,"手札 "+h(n.value.te.length),1),s("button",{onClick:i[17]||(i[17]=o=>{n.value.useCard(void 0),E()})}," AP SKIP ")]),i[41]||(i[41]=s("hr",null,null,-1)),s("div",$e,[(f(!0),c(S,null,F(n.value.te,(o,b)=>(f(),N(R,{card:o,stage:n.value,te:!0,class:oe({highlight:I.value==b}),onClick:k=>{n.value.useCard(b),E()}},null,8,["card","stage","class","onClick"]))),256))]),s("h2",null,"捨札 "+h(n.value.sute.length),1),i[42]||(i[42]=s("hr",null,null,-1)),s("div",Ie,[(f(!0),c(S,null,F(n.value.sute,(o,b)=>(f(),N(R,{card:o,stage:n.value,"pointer-events":"none"},null,8,["card","stage"]))),256))]),s("h2",null,"山札 "+h(n.value.yama.length),1),i[43]||(i[43]=s("hr",null,null,-1)),s("div",Ne,[(f(!0),c(S,null,F(n.value.yama,(o,b)=>(f(),N(R,{card:o,stage:n.value,"pointer-events":"none"},null,8,["card","stage"]))),256))])],64)):(f(),c(S,{key:2},[(f(!0),c(S,null,F(l.value,(o,b)=>(f(),c("table",null,[s("thead",null,[s("tr",null,[s("td",Re,h(o.deck),1)]),s("tr",null,[s("td",He,"AP回复速度: "+h(o.formData.apSpeed),1),s("td",Ue,"暂停回数: "+h(o.formData.cardTimes),1),s("td",qe,"SKIP回数: "+h(o.formData.skipTimes),1)]),s("tr",null,[s("td",Ke,"SP: "+h(o.formData.sp),1),s("td",Oe,"效果: "+h(o.formData.effect),1),s("td",Le,"策略: "+h(o.formData.strategy),1)]),i[44]||(i[44]=s("tr",null,[s("td",null,[D("target"),s("br"),D("💎")]),s("td",null,[D("kol慈"),s("br"),D("回数")]),s("td",null,[D("💎"),s("br"),D("回数")]),s("td",null,[D("AP SKIP"),s("br"),D("回数")]),s("td",null,"pt"),s("td",null,"%")],-1))]),s("tbody",null,[(f(!0),c(S,null,F(o.dict,(k,y)=>(f(),c("tr",{style:{cursor:"pointer"},onClick:C=>{m.value={key:y,...k},ne(()=>u.value.showModal())}},[s("td",null,h(y),1),s("td",null,h(k.cardTimesDict.kol慈??0),1),s("td",null,h(k.cardTimesDict["💎"]??0),1),s("td",null,h(k.cardTimesDict.apSkip),1),s("td",null,h(k.score),1),s("td",null,h(Number((k.score/Math.max(...Object.values(o.dict).map(C=>C.score))*100).toFixed(2))),1)],8,Be))),256))])]))),256)),m.value?(f(),c("dialog",{key:0,ref_key:"dialog",ref:u},[s("table",null,[s("thead",null,[s("tr",null,[i[45]||(i[45]=s("td",null,"target💎",-1)),s("td",null,h(m.value.key),1)]),s("tr",null,[i[46]||(i[46]=s("td",null,"pt",-1)),s("td",null,h(m.value.score),1)])]),s("tbody",null,[(f(!0),c(S,null,F(m.value.cardTimesDict,(o,b)=>(f(),c("tr",null,[s("td",null,h(b),1),s("td",null,h(o)+"回",1)]))),256))]),s("tfoot",null,[s("tr",null,[s("td",Ge,[s("button",{onClick:i[18]||(i[18]=o=>m.value=void 0)},"关闭")])])])])],512)):V("",!0)],64))]))}},Je=se(Ye,[["__scopeId","data-v-493d34e8"]]);export{Je as default};
