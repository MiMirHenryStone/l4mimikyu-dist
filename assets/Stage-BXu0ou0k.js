import{_ as re,o as m,c,a as l,n as $,t as b,b as V,r as k,F as M,d as F,u as H,w as j,v as ne,e as W,f as L,g as D,h as E,i as ae}from"./index-BmsUIs9-.js";let se=class le{constructor(e){this.score=0,this.te=[],this.sute=[],this.yama=e,this.ignition=!1,this.timesDict={kolÊÖà:0,"üíé":0},this.timesCount=0,this.sp="",this.effects={},this.teMax=8,this.apMax=20}getAllCards(){return[...this.te,...this.sute,...this.yama]}getDrawYama(){return this.yama.length?this.yama:this.sute}start(){for(let e=0;e<this.teMax;e++){let r=Math.floor(Math.random()*this.yama.length),s=this.yama.splice(r,1)[0];this.te.push(s)}}draw(e,r){this.yama.length||(this.yama=[...this.sute],this.sute=[],this.effects.a&&this.yama.forEach(u=>{u.getMain(this)=="reshuffle"&&(u.cost+=1)}));let s;r?(s=this.yama.filter(u=>u.matchAttrs(r)),s.length||(s=this.yama)):s=this.yama;let a=Math.floor(Math.random()*s.length),o=s[a];this.yama.splice(this.yama.findIndex(u=>u.short==o.short),1),this.te[e]=o,o.onDraw(this)}useCard(e){var a,o,u,d,y,v;let r=this.te[e];(r.short=="kolÊÖà"||r.short=="üíé")&&this.timesDict[r.short]++;let s=r.isReshuffle(this);r.onSkill(this);for(let f of this.te)f.onCross(this,r);if(this.sp=="sy"&&this.score++,s){for(let f in this.te)f!=e&&this.sute.push(this.te[f]);(a=r.props)!=null&&a.yamaReshuffle&&this.yama.push(...this.sute.splice(0));for(let f=0;f<this.teMax;f++)this.draw(f,(u=(o=r.props)==null?void 0:o.drawFilters)==null?void 0:u[f])}else this.draw(e,(y=(d=r.props)==null?void 0:d.drawFilters)==null?void 0:y[0]);if((v=r.props)!=null&&v.once||this.sute.push(r),r.cost=r.props.cost,r.afterSkill(this),this.timesCount++,this.effects.b&&this.timesCount%5==0){this.sute.push(...this.te.splice(0));for(let f=0;f<this.teMax;f++)this.draw(f)}}testCard(e){var a;let r=new le([]);for(let o of this.te)r.te.push(o.copy());r.ignition=this.ignition,r.timesDict=this.timesDict,r.sp=this.sp;let s=r.te[e];s.isReshuffle(this),s.onSkill(r);for(let o of r.te)o.onCross(r,s);return(a=s.props)!=null&&a.once||r.sute.push(s),s.cost=s.props.cost,r.score}trigger(e){this.addHeart(e.heart),this.addVoltage(e.voltage),this.addMental(e.mental),this.addProtect(e.protect),this.subtractAp(e["ap-"])}addHeart(e){e&&(this.score+=e)}addVoltage(e){e&&this.sp=="td"&&(this.score+=e)}addMental(e){e&&this.sp=="mg2"&&(this.score+=e)}addProtect(e){e&&this.sp=="mg2"&&(this.score+=e)}subtractAp(e){if(e!=null&&e.length)for(let r of this.getAllCards())r.cost+=r.calcSubtractAp(e)}};class w{constructor(e){this.short=e,this.props={short:e};let r=O.find(s=>s.short==e);if(r){this.props=r,this.member=r.member;let s=ue.find(a=>a.member==r.member);s&&(this.year=s.year,this.unit=s.unit),this.cost=r.cost,this.teCostDelta=0}}copy(){let e=new w(this.short);return e.cost=this.cost,e.teCostDelta=this.teCostDelta,e}getMain(e){var r;return(r=this.props)!=null&&r.main?typeof this.props.main=="function"?this.props.main(e):this.props.main:""}getCost(e=!1){let r=this.cost;return e&&(r+=this.teCostDelta),r>=1?r:1}isReshuffle(e){var r;return(r=this.props)!=null&&r.reshuffle?typeof this.props.reshuffle=="function"?this.props.reshuffle(e):this.props.reshuffle:!1}onSkill(e){var r;(r=this.props)!=null&&r.skill&&(typeof this.props.skill=="function"?this.props.skill(e):e.trigger(this.props.skill))}afterSkill(e){var r;(r=this.props)!=null&&r.afterSkill&&this.props.afterSkill(e)}onDraw(e){var r;this.teCostDelta=0,(r=this.props)!=null&&r.draw&&(typeof this.props.draw=="function"?this.props.draw(e,this):e.trigger(this.props.draw))}onCross(e,r){var s;(s=this.props)!=null&&s.cross&&this.props.cross(e,r,this)}matchAttrs(e){return Object.keys(e).every(r=>e[r]==null?!0:e[r]==this[r])}calcSubtractAp(e){let r=0;if(e!=null&&e.length)for(let s of e)this.matchAttrs({...s,cost:void 0})&&(r+=s.cost);return r}}const ue=[{member:3,short:"kz",year:102,unit:"srb"},{member:4,short:"td",year:102,unit:"drk"},{member:6,short:"mg",year:102,unit:"mrp"},{member:1,short:"kh",year:103,unit:"srb"},{member:2,short:"sy",year:103,unit:"drk"},{member:5,short:"rr",year:103,unit:"mrp"},{member:7,short:"gn",year:104,unit:"srb"},{member:8,short:"sz",year:104,unit:"drk"},{member:9,short:"hm",year:104,unit:"mrp"}],O=[{short:"Âú£Â§úÂêü",member:7,cost:8,main:"dress",reshuffle:!0,skill(t){for(let e=0;e<5;e++)t.yama.push(new w("Âú£Â§úüëó"))}},{short:"Âú£Â§úüëó",member:"dress",cost:3,main:"reshuffle",reshuffle:!0,once:!0,skill:{mental:1,voltage:1}},{short:"paÂêü",member:7,cost:4,main:"dress",skill(t){for(let e=0;e<2;e++)t.yama.push(new w("paÂêüüëó"))}},{short:"paÂêüüëó",member:"dress",cost:2,main:"ap",once:!0},{short:"lttfÈìÉ",member:8,cost:9,main:"voltage",drawFilters:[{member:9}]},{short:"‰∏äÂçáÂß¨ËäΩ",member:9,cost:3,main(t){return t!=null&&t.ignition?"reshuffle":"mental"},reshuffle:t=>t==null?void 0:t.ignition,skill:{mental:1,protect:1},afterSkill(t){t.ignition&&(t.timesDict[this.short]==null?t.timesDict[this.short]=0:t.timesDict[this.short]++,t.timesDict[this.short]>=3&&(t.ignition=!1,t.timesDict[this.short]=void 0),t.getAllCards().forEach(e=>{e.unit=="mrp"&&(e.cost-=3)}))},cross(t,e){if(!t.ignition){let r=e.getMain(t);(r=="mental"||r=="protect")&&(t.ignition=!0)}}},{short:"paÂß¨ËäΩ",member:9,cost:4,main:"reshuffle",reshuffle:!0,skill:{protect:1}},{short:"ÁªáÂß¨Ëä±Â∏Ü",member:1,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1}},{short:"Èü≥ÂáªËä±Â∏Ü",member:1,cost:9,main:"heart",reshuffle:!0,yamaReshuffle:!0,skill:{heart:3},draw:{heart:1,mental:1}},{short:"lttfÊ≤ôËÄ∂",member:2,cost:5,main:"voltage",drawFilters:[{member:6}]},{short:"Ê≤èËå∂Áë†ÁíÉ",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{voltage:1},draw:{heart:1}},{short:"ËõãÁ≥ïÁë†ÁíÉ",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{heart:1},draw:{heart:1}},{short:"Ëä±ÁªìÊ¢¢",member:3,cost:13,main:"reshuffle",reshuffle:!0,drawFilters:[{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"}],cross(t,e,r){e.unit=="srb"&&(t.trigger({heart:1}),r.teCostDelta-=3)},afterSkill(t){t.getAllCards().forEach(e=>{(e.unit=="srb"||e.member=="dress")&&(e.cost-=3)})}},{short:"kolÊ¢¢",member:3,cost:9,main:"mental",skill:{mental:1,heart:1},draw:{"ap-":[{member:6,cost:-9}]},cross(t,e){e.member==6&&t.trigger({protect:1,heart:1})}},{short:"Ëá™Áî±ÁºÄ",member:4,cost:2,main:"mental",skill:{mental:1,heart:1},draw:{heart:1}},{short:"kolÁºÄ",member:4,cost:3,main:"voltage",skill:{voltage:1,heart:1},draw:{"ap-":[{member:3,cost:-3},{member:6,cost:-3}]},cross(t,e){e.member==6&&t.trigger({voltage:1,heart:1})}},{short:"hsctÊÖà",member:6,cost:4,main:"reshuffle",reshuffle:!0},{short:"kolÊÖà",member:6,cost:39,main:"heart",skill:{heart:2},cross(t,e,r){(e.member==1||e.member==2||e.member==3||e.member==4||e.member==5||e.member==7||e.member==8||e.member==9)&&(r.teCostDelta-=3)},afterSkill(t){t.yama.push(new w("üíé"))}},{short:"üíé",member:"jewelry",cost:1,main:"ap-",once:!0,draw:{heart:1,voltage:1,protect:1}},{short:"Ëàû‰ºöÁºÄ",member:4,cost:2,main:"voltage",skill:{voltage:1}},{short:"Ëàû‰ºöÊ≤ôËÄ∂",member:2,cost:2,main:"love+"},{short:"Èì∂Ê≤≥ÊÖà",member:6,cost:5,main:"reshuffle",reshuffle:!0,skill:{mental:2,protect:1}}],he={class:"cost"},me={key:0,class:"close"},fe={key:1,class:"test"},de={key:2,class:"time"},ce={__name:"Card",props:{card:{type:w},stage:{type:se},te:{default:!1},close:{default:!1},pointerEvents:{default:"auto"}},setup(t){const e=t,r={heart:"rgb(204,39,39)","love+":"rgb(174,141,24)",voltage:"rgb(174,141,24)",mental:"rgb(48,124,24)",reshuffle:"rgb(134,82,195)",protect:"rgb(48,124,24)",dress:"rgb(134,82,195)",ap:"rgb(174,141,24)","ap-":"rgb(134,82,195)","":"transparent"},s={1:"#f8b500",2:"#5383c3",3:"#68be8d",4:"#ba2636",5:"#e7609e",6:"#c8c2c6",7:"#a2d7dd",8:"#fad764",9:"#9d8de2"};return(a,o)=>{var u,d;return m(),c("div",{class:"card",style:$({pointerEvents:t.te&&e.card.getCost(t.te)>20?"none":e.pointerEvents})},[l("div",{class:"background",style:$({backgroundColor:s[e.card.member]?`${s[e.card.member]}`:"transparent"})},null,4),l("div",{style:$({fontWeight:e.card.isReshuffle(e.stage)?"bold":""})},b(e.card.short),5),l("div",he,b(e.card.getCost(t.te)),1),l("div",{class:"main",style:$({backgroundColor:r[e.card.getMain(e.stage)]})},null,4),e.close?(m(),c("div",me,"√ó")):V("",!0),e.te?(m(),c("div",fe,b(e.stage.testCard(e.stage.te.indexOf(e.card))),1)):V("",!0),((u=e.stage)==null?void 0:u.timesDict[e.card.short])!=null?(m(),c("div",de,b((d=e.stage)==null?void 0:d.timesDict[e.card.short]),1)):V("",!0)],4)}}},T=re(ce,[["__scopeId","data-v-87406ac9"]]);function A(t){let e=[];for(let r=0;r<t.te.length;r++)t.te[r].getCost()<=t.apMax&&e.push(r);return e}function R(t,e){let r=e.map(a=>t.testCard(a)),s=Math.max(...r);return e.filter((a,o)=>r[o]==s)}function U(t,e){let r=e.map(a=>t.te[a].getCost(!0)),s=Math.min(...r);return e.filter((a,o)=>r[o]==s)}function J(t,e){let r=e.map(a=>{let o=t.te[a],u=0;return t.getAllCards().forEach(d=>{var y,v,f,C;(v=(y=d.props)==null?void 0:y.draw)!=null&&v["ap-"]&&(u+=o.calcSubtractAp((C=(f=d.props)==null?void 0:f.draw)==null?void 0:C["ap-"]))}),u}),s=Math.min(...r);return e.filter((a,o)=>r[o]==s)}function X(t,e){let r=t.getDrawYama(),s=e.map(o=>{var y,v;let u=t.te[o],d=r;if((y=u.props)!=null&&y.drawFilters){let f=(v=u.props)==null?void 0:v.drawFilters[0];d=r.filter(C=>Object.keys(f).every(h=>C[h]==f[h])),d.length||(d=r)}return d.filter(f=>f.isReshuffle(t)).length/d.length}),a=Math.max(...s);return e.filter((o,u)=>s[u]==a)}function q(t,e){let r=e.filter(s=>{var a,o;return(o=(a=t.te[s].props)==null?void 0:a.drawFilters)==null?void 0:o.length});return r.length?r:e}function Q(t,e){let r=e.filter(s=>{var a;return(a=t.te[s].props)==null?void 0:a.yamaReshuffle});return r.length?r:e}function I(t,e){let r=e.filter(s=>t.te[s].member=="dress");return r.length?r:e}function N(t,e){let r=e.filter(s=>t.te[s].getMain(t)!="dress");return r.length?r:e}function Z(t,e){let r=e.filter(s=>{var a;return typeof((a=t.te[s].props)==null?void 0:a.reshuffle)!="function"});return r.length?r:e}function ee(t,e){let r=e.filter(s=>t.te[s].member!="jewelry");return r.length?r:e}function te(t,e=9,r="score"){let s,a;if(!t.ignition&&t.te.find(o=>o.short=="‰∏äÂçáÂß¨ËäΩ")&&t.te.find(o=>(o.getMain(t)=="mental"||o.getMain(t)=="protect")&&o.short!="‰∏äÂçáÂß¨ËäΩ"))r=="cost"?s=R(t,U(t,A(t).filter(o=>{let u=t.te[o];return(u.getMain(t)=="mental"||u.getMain(t)=="protect")&&u.short!="‰∏äÂçáÂß¨ËäΩ"})))[0]:s=R(t,A(t).filter(o=>{let u=t.te[o];return(u.getMain(t)=="mental"||u.getMain(t)=="protect")&&u.short!="‰∏äÂçáÂß¨ËäΩ"}))[0];else if(a=t.te.findIndex(o=>o.short=="kolÊÖà"),a>=0&&t.getAllCards().filter(o=>o.member=="jewelry").length<e&&t.te[a].getCost(!0)<(r=="score"?t.apMax:10))s=a;else if(A(t).find(o=>t.te[o].isReshuffle(t))!=null){let o=A(t).filter(u=>t.te[u].isReshuffle(t));r=="cost"?s=J(t,q(t,Z(t,R(t,U(t,N(t,I(t,Q(t,o))))))))[0]:s=q(t,R(t,Z(t,N(t,I(t,Q(t,o))))))[0]}else r=="cost"?s=J(t,R(t,U(t,X(t,ee(t,N(t,I(t,A(t))))))))[0]:s=R(t,X(t,ee(t,N(t,I(t,A(t))))))[0];if(s==null)debugger;return s}const pe={class:"grid"},be={class:"grid"},ve=["disabled"],ye=["disabled"],ke=["disabled"],ge=["disabled"],we=["disabled"],Ce=["disabled"],Me={style:{"text-align":"right"}},De={key:0,style:{width:"100%"}},Se={style:{float:"right"}},xe={key:0},Fe={key:1},je={class:"grid"},Ae={class:"grid"},Re={class:"grid"},Ee={__name:"Stage",setup(t){const e=k(!1),r=k(!1),s=k({}),a=k(9),o=k(20),u=k(360),d=k(36),y=k(""),v=k({}),f=O.map(g=>new w(g.short)),C=k(O.filter(g=>typeof g.member=="number").map(g=>new w(g.short)).slice(0,16)),h=k(),P=()=>{h.value=new se([]),h.value.sp=y.value,h.value.effects=v.value};P();const ie=()=>{e.value=!1,s.value={},P()},z=async g=>{var i;if(e.value=!0,r.value=g,g)for(let n=0;n<=Number(o.value)&&(await oe(100),!!e.value);n++){s.value[n]={list:[]};let p=0,S=0,Y=0,_=0;for(let G=0;G<Number(d.value);G++){P(),h.value.yama=C.value.map(x=>new w(x.short)),h.value.start();for(let x=0;x<Number(u.value)&&e.value;x++)h.value.useCard(te(h.value,n,h.value.sp=="mg2"?"score":"cost"));if(!e.value)break;p+=h.value.score,S+=(i=h.value.getAllCards().filter(x=>x.member=="jewelry"))==null?void 0:i.length,Y+=h.value.timesDict.kolÊÖà,_+=h.value.timesDict["üíé"]}if(s.value[n].score=Number((p/d.value).toFixed(2)),s.value[n].jewelryCount=Number((S/d.value).toFixed(2)),s.value[n].kt=Number((Y/d.value).toFixed(2)),s.value[n].jt=Number((_/d.value).toFixed(2)),!e.value)break}else h.value.yama=C.value.map(n=>new w(n.short)),h.value.start(),K()},oe=async g=>new Promise(i=>setTimeout(i,g)),B=k(-1),K=()=>{B.value=te(h.value,a.value,h.value.sp=="mg2"?"score":"cost")};return(g,i)=>(m(),c("div",null,[e.value?V("",!0):(m(),c(M,{key:0},[i[8]||(i[8]=l("h2",null,"DECK",-1)),i[9]||(i[9]=l("hr",null,null,-1)),l("div",pe,[(m(!0),c(M,null,F(C.value,(n,p)=>(m(),E(T,{key:p,card:n,close:!0,onClick:S=>C.value.splice(p,1)},null,8,["card","onClick"]))),128))]),i[10]||(i[10]=l("h2",null,"CARD",-1)),i[11]||(i[11]=l("hr",null,null,-1)),l("div",be,[(m(!0),c(M,null,F(H(f),(n,p)=>(m(),E(T,{key:p,card:n,onClick:S=>C.value.push(new(H(w))(n.short))},null,8,["card","onClick"]))),128))])],64)),l("form",null,[i[19]||(i[19]=l("h2",null,"STAGE",-1)),i[20]||(i[20]=l("hr",null,null,-1)),l("div",null,[i[13]||(i[13]=l("label",{for:"sp"},"SP: ",-1)),j(l("select",{"onUpdate:modelValue":i[0]||(i[0]=n=>y.value=n),disabled:e.value,id:"sp"},i[12]||(i[12]=[l("option",{value:""},"--",-1),l("option",{value:"td"},"Ëàû‰ºöÁºÄ",-1),l("option",{value:"sy"},"Ëàû‰ºöÊ≤ôËÄ∂",-1),l("option",{value:"mg2"},"Èì∂Ê≤≥ÊÖà",-1)]),8,ve),[[ne,y.value]])]),l("div",null,[j(l("input",{"onUpdate:modelValue":i[1]||(i[1]=n=>v.value.a=n),disabled:e.value,type:"checkbox",id:"104-3-3-1-a"},null,8,ye),[[W,v.value.a]]),i[14]||(i[14]=l("label",{for:"104-3-3-1-a"}," Â±±Êú≠Âàá mainÊïàÊûúreshuffleÊïàÊûúdeckÂÖ®cardÊ∂àË¥πAP+1 ",-1))]),l("div",null,[j(l("input",{"onUpdate:modelValue":i[2]||(i[2]=n=>v.value.b=n),disabled:e.value,type:"checkbox",id:"104-3-3-1-b"},null,8,ke),[[W,v.value.b]]),i[15]||(i[15]=l("label",{for:"104-3-3-1-b"}," skill5Âõû‰ΩøÁî® ÊâãÊú≠ÂÖ®Êç® Â±±Êú≠ÊâãÊú≠‰∏äÈôêÂºïÁõ¥ ",-1))]),l("div",null,[i[16]||(i[16]=l("label",{for:"jewelry"},"MAX TARGET JEWELRY: ",-1)),j(l("input",{"onUpdate:modelValue":i[3]||(i[3]=n=>o.value=n),disabled:e.value,type:"number",id:"jewelry"},null,8,ge),[[L,o.value]])]),l("div",null,[i[17]||(i[17]=l("label",{for:"card-time"},"CARDÂõûÊï∞: ",-1)),j(l("input",{"onUpdate:modelValue":i[4]||(i[4]=n=>u.value=n),disabled:e.value,type:"number",id:"card-time"},null,8,we),[[L,u.value]])]),l("div",null,[i[18]||(i[18]=l("label",{for:"skip-time"},"SKIPÂõûÊï∞: ",-1)),j(l("input",{"onUpdate:modelValue":i[5]||(i[5]=n=>d.value=n),disabled:e.value,type:"number",id:"skip-time"},null,8,Ce),[[L,d.value]])])]),l("div",Me,[e.value?(m(),c("button",{key:0,onClick:ie},"RETIRE")):(m(),c(M,{key:1},[l("button",{onClick:i[6]||(i[6]=n=>z(!0))},"SKIP"),l("button",{onClick:i[7]||(i[7]=n=>z(!1))},"LIVE START")],64))]),e.value?(m(),c(M,{key:1},[r.value?(m(),c("table",De,[i[21]||(i[21]=l("tr",null,[l("td",null,[D("target"),l("br"),D("jewelry")]),l("td",null,[D("actual"),l("br"),D("jewelry")]),l("td",null,[D("kolÊÖà"),l("br"),D("ÂõûÊï∞")]),l("td",null,[D("jewelry"),l("br"),D("ÂõûÊï∞")]),l("td",null,"score"),l("td",null,"percent")],-1)),(m(!0),c(M,null,F(s.value,(n,p)=>(m(),c("tr",{key:p},[l("td",null,b(p),1),l("td",null,b(n.jewelryCount),1),l("td",null,b(n.kt),1),l("td",null,b(n.jt),1),l("td",null,b(n.score),1),l("td",null,b(Number((n.score/Math.max(...Object.values(s.value).map(S=>S.score))*100).toFixed(2))),1)]))),128))])):(m(),c(M,{key:1},[l("h2",null,[D(b(h.value.score)+" ",1),l("div",Se,b(h.value.timesCount)+"Âõû",1)]),h.value.ignition?(m(),c("h2",xe,"üî•")):(m(),c("h2",Fe,"üö´")),l("h2",null,"ÊâãÊú≠ "+b(h.value.te.length),1),i[22]||(i[22]=l("hr",null,null,-1)),l("div",je,[(m(!0),c(M,null,F(h.value.te,(n,p)=>(m(),E(T,{key:p,card:n,stage:h.value,te:!0,class:ae({highlight:B.value==p}),onClick:S=>{h.value.useCard(p),K()}},null,8,["card","stage","class","onClick"]))),128))]),l("h2",null,"Êç®Êú≠ "+b(h.value.sute.length),1),i[23]||(i[23]=l("hr",null,null,-1)),l("div",Ae,[(m(!0),c(M,null,F(h.value.sute,(n,p)=>(m(),E(T,{key:p,card:n,stage:h.value,"pointer-events":"none"},null,8,["card","stage"]))),128))]),l("h2",null,"Â±±Êú≠ "+b(h.value.yama.length),1),i[24]||(i[24]=l("hr",null,null,-1)),l("div",Re,[(m(!0),c(M,null,F(h.value.yama,(n,p)=>(m(),E(T,{key:p,card:n,stage:h.value,"pointer-events":"none"},null,8,["card","stage"]))),128))])],64))],64)):V("",!0)]))}},Ve=re(Ee,[["__scopeId","data-v-e26db62d"]]);export{Ve as default};
