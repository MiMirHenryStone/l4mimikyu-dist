import{_ as Z,o as p,c as b,a as s,n as q,t as f,e as P,f as w,F as S,g as j,d as C,u as B,h as D,v as F,i as O,j as te,k as G,l as I,m as re}from"./index-6k-B6tos.js";class x{constructor(e){this.short=e,this.props={short:e};let r=K.find(a=>a.short==e);if(r){this.props=r,this.member=r.member;let a=se.find(i=>i.member==r.member);a&&(this.year=a.year,this.unit=a.unit),this.cost=r.cost,this.teCostDelta=0}}copy(){let e=new x(this.short);return e.cost=this.cost,e.teCostDelta=this.teCostDelta,e}getMain(e){var r;return(r=this.props)!=null&&r.main?typeof this.props.main=="function"?this.props.main(e):this.props.main:""}getCost(e=!1){var a,i;let r=this.cost;return e&&((a=this.props)!=null&&a.teCostDelta)&&(r+=(i=this.props)==null?void 0:i.teCostDelta(e)),e&&(r+=this.teCostDelta),r>=1?r:1}isReshuffle(e){var r;return(r=this.props)!=null&&r.reshuffle?typeof this.props.reshuffle=="function"?this.props.reshuffle(e):this.props.reshuffle:!1}getSkill(e){var r;if((r=this.props)!=null&&r.skill)return typeof this.props.skill=="function"?this.props.skill(e):this.props.skill}onSkill(e){e.trigger(this.getSkill(e))}afterSkill(e){var r;(r=this.props)!=null&&r.afterSkill&&this.props.afterSkill(e)}onDraw(e){var r;this.teCostDelta=0,(r=this.props)!=null&&r.draw&&(typeof this.props.draw=="function"?e.trigger(this.props.draw(e,this)):e.trigger(this.props.draw))}calcDrawHeartCount(e){var i,m,d,n;let r=0,a;return(i=this.props)!=null&&i.draw&&(typeof((m=this.props)==null?void 0:m.draw)=="function"?a=(d=this.props)==null?void 0:d.draw(e):a=(n=this.props)==null?void 0:n.draw),r+=(a==null?void 0:a.heart)||0,e.sp=="tz"&&(r+=(a==null?void 0:a.voltage)||0),e.sp=="mg2"&&(r+=((a==null?void 0:a.mental)||0)+((a==null?void 0:a.protect)||0)),r}onCross(e,r){var a;(a=this.props)!=null&&a.cross&&this.props.cross(e,r,this)}matchAttrs(e){return Object.keys(e).every(r=>e[r]==null?!0:e[r]==this[r])}calcSubtractAp(e){let r=0;if(e!=null&&e.length)for(let a of e)this.matchAttrs({...a,cost:void 0})&&(r+=a.cost);return r}}const se=[{member:3,short:"kz",year:102,unit:"srb"},{member:4,short:"tz",year:102,unit:"drk"},{member:6,short:"mg",year:102,unit:"mrp"},{member:1,short:"kh",year:103,unit:"srb"},{member:2,short:"sy",year:103,unit:"drk"},{member:5,short:"rr",year:103,unit:"mrp"},{member:7,short:"gn",year:104,unit:"srb"},{member:8,short:"sz",year:104,unit:"drk"},{member:9,short:"hm",year:104,unit:"mrp"}],K=[{short:"圣夜吟",member:7,cost:8,main:"dress",reshuffle:!0,skill:{cards:["圣夜👗","圣夜👗","圣夜👗","圣夜👗","圣夜👗"]}},{short:"圣夜👗",member:"dress",cost:3,main:"reshuffle",reshuffle:!0,once:!0,skill:{mental:1,voltage:1}},{short:"pa吟",member:7,cost:4,main:"dress",skill:{cards:["pa👗","pa👗"]}},{short:"pa👗",member:"dress",cost:2,main:"ap",once:!0},{short:"lttf铃",member:8,cost:9,main:"voltage",skill:{voltage:1,mental:-1},drawFilters:[{member:9}]},{short:"上升姬芽",member:9,cost:3,main(t){return t!=null&&t.ignition?"reshuffle":"mental"},reshuffle:t=>t==null?void 0:t.ignition,skill:{mental:1,protect:1},afterSkill(t){t.ignition&&(t.timesDict[this.short]==null?t.timesDict[this.short]=0:t.timesDict[this.short]++,t.timesDict[this.short]>=3&&(t.ignition=!1,t.timesDict[this.short]=void 0),t.trigger({"ap-":[{unit:"mrp",cost:-3}]}))},cross(t,e){if(!t.ignition){let r=e.getMain(t);(r=="mental"||r=="protect")&&(t.ignition=!0)}}},{short:"pa姬芽",member:9,cost:4,main:"reshuffle",reshuffle:!0,skill:{protect:1}},{short:"织姬花帆",member:1,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1}},{short:"音击花帆",member:1,cost:9,main:"heart",reshuffle:!0,yamaReshuffle:!0,skill:{heart:3},draw:{heart:1,mental:1}},{short:"lttf沙耶",member:2,cost:5,main:"voltage",skill:{voltage:1},drawFilters:[{member:6}]},{short:"沏茶瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{voltage:1},draw:{heart:1}},{short:"蛋糕瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{heart:1},draw:{heart:1}},{short:"花结梢",member:3,cost:13,main:"reshuffle",reshuffle:!0,drawFilters:[{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"},{unit:"srb"},{member:"dress"}],cross(t,e,r){e.unit=="srb"&&(t.trigger({heart:1}),r.teCostDelta-=3)},afterSkill(t){t.getAllCards().forEach(e=>{(e.unit=="srb"||e.member=="dress")&&(e.cost-=3)})}},{short:"kol梢",member:3,cost:9,main:"mental",skill:{mental:1,heart:1},draw:{"ap-":[{member:6,cost:-9}]},cross(t,e){e.member==6&&t.trigger({protect:1,heart:1})}},{short:"自由缀",member:4,cost:2,main:"mental",skill:{mental:1,heart:1},draw:t=>{let e={};return t.mental&&(e={heart:1}),e}},{short:"kol缀",member:4,cost:3,main:"voltage",skill:{voltage:1,heart:1},draw:{"ap-":[{member:3,cost:-3},{member:6,cost:-3}]},cross(t,e){e.member==6&&t.trigger({voltage:1,heart:1})}},{short:"hsct慈",member:6,cost:4,main:"reshuffle",reshuffle:!0},{short:"kol慈",member:6,cost:39,main:"heart",skill:{heart:2,cards:["💎"]},cross(t,e,r){(e.member==1||e.member==2||e.member==3||e.member==4||e.member==5||e.member==7||e.member==8||e.member==9)&&(r.teCostDelta-=3)}},{short:"💎",member:"jewelry",cost:1,main:"ap-",once:!0,skill:{"ap-":[{cost:-1}]},draw:{heart:1,voltage:1,protect:1}},{short:"舞会缀",member:4,cost:2,main:"voltage",skill:{voltage:1}},{short:"舞会沙耶",member:2,cost:2,main:"love+"},{short:"银河缀",member:4,cost:2,main:"voltage",skill:{voltage:1,heart:1},afterSkill(t){t.sp=="tz2"&&t.trigger({ap:5})}},{short:"银河慈",member:6,cost:5,main:"reshuffle",reshuffle:!0,skill:{mental:2,protect:1},afterSkill(t){t.sp=="mg2"&&t.trigger({ap:20})}},{short:"讴歌梢",member:3,cost:3,main:"love+",draw:{heart:1}},{short:"ritm梢",member:3,cost:2,main:"voltage",skill:{voltage:1},draw:{mental:1}},{short:"秋色梢",member:3,cost:6,main:"love+",draw:{mental:1}},{short:"自由梢",member:3,cost:2,main:"protect",skill:{protect:1},draw:t=>{let e={};return t.mental&&(e={protect:1}),e}},{short:"教师梢",member:3,cost:2,main:"heart",skill:{heart:1,mental:-1},draw:{mental:1}},{short:"ss缀",member:4,cost:3,main:"heart",skill:{heart:1},draw:{voltage:1}},{short:"雨伞缀",member:4,cost:5,main:"love+",draw:{heart:1}},{short:"花火缀",member:4,cost:3,main:"voltage",skill:{voltage:1},draw:{voltage:1}},{short:"秋色缀",member:4,cost:6,main:"heart",skill:t=>{let e={};return t.mental?e={heart:3}:e={heart:2},e},draw:{mental:1}},{short:"抱花缀",member:4,cost:4,main:"voltage",skill:{voltage:1},draw:{voltage:1}},{short:"音击缀",member:4,cost:9,main:"voltage",skill:{voltage:1,heart:3},draw:{voltage:1,protect:1}},{short:"蛋糕慈",member:6,cost:4,main:"mental",skill:{mental:1},draw:{mental:1,protect:1}},{short:"舞会慈",member:6,cost:3,main:"love+",yamaUse:!0,skill:{mental:-1},draw:{mental:1}},{short:"圣诞慈",member:6,cost:4,main:"mental",skill:{mental:3},draw:{mental:1}},{short:"抱花慈",member:6,cost:4,main:"protect",skill:{protect:1},draw:{protect:1}},{short:"ritm花帆",member:1,cost:1,main:"heart",skill:{heart:1},draw:{mental:1}},{short:"讴歌花帆",member:1,cost:3,main:"mental",skill:{mental:1},draw:{voltage:1}},{short:"雨伞花帆",member:1,cost:3,main:"voltage",skill:{voltage:1},draw:{mental:1}},{short:"自由花帆",member:1,cost:2,main:"voltage",skill:{voltage:1,heart:1},draw:t=>{let e={};return t.mental&&(e={voltage:1}),e}},{short:"偶活花帆",member:1,cost:9,main:"heart",reshuffle:!0,skill:{heart:1},cross(t,e,r){(e.member==2||e.member==5)&&(r.teCostDelta-=2)}},{short:"快乐花帆",member:1,cost:2,main:"mental",skill:{mental:1,voltage:1},draw:{mental:1,heart:1}},{short:"雨伞沙耶",member:2,cost:4,main:"mental",skill:{mental:1},draw:{voltage:1}},{short:"tc沙耶",member:2,cost:3,main:"love+",skill:{mental:-1},draw:{voltage:1}},{short:"宇宙沙耶",member:2,cost:4,main:"teMax",skill:{voltage:1}},{short:"沏茶沙耶",member:2,cost:2,main:"love+",skill:{voltage:1}},{short:"圣诞沙耶",member:2,cost:4,main:"voltage",skill:{voltage:1,heart:2},draw:{voltage:1}},{short:"db瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{voltage:1},draw:{voltage:1}},{short:"梦境瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{heart:1}},{short:"rod瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1},draw:{mental:1}},{short:"一专瑠璃",member:5,cost:5,main:"reshuffle",reshuffle:!0,skill:{heart:1}},{short:"abdl瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,skill:{mental:1}},{short:"白昼瑠璃",member:5,cost:3,main:"reshuffle",reshuffle:!0,skill:{mental:-1},draw:{heart:1}},{short:"mc瑠璃",member:5,cost:4,main:"reshuffle",reshuffle:!0,afterSkill(t){t.ignition?t.trigger({heart:1}):t.trigger({ap:1})}},{short:"ritm吟",member:7,cost:5,main:"dress",skill:{cards:["ritm👗1","ritm👗2","ritm👗3"]},draw:{protect:1}},{short:"ritm👗1",member:"dress",cost:1,main:"heart",once:!0,skill:{heart:1}},{short:"ritm👗2",member:"dress",cost:1,main:"voltage",once:!0,skill:{voltage:1}},{short:"ritm👗3",member:"dress",cost:1,main:"teMax",once:!0},{short:"蓝远吟",member:7,cost:3,main:"dress",skill:{cards:["蓝远👗","蓝远👗","蓝远👗"]},cross(t,e){e.unit=="srb"&&t.trigger({voltage:1})}},{short:"蓝远👗",member:"dress",cost:2,main:"reshuffle",reshuffle:!0,once:!0,skill:{heart:1}},{short:"花结吟",member:7,cost:13,teCostDelta(t){let e=0;for(let r of t)r.unit=="srb"&&(e-=3);return e},main:"dress",reshuffle:!0,skill:{cards:["花结👗1","花结👗1","花结👗1","花结👗2","花结👗2","花结👗2","花结👖3","花结👖3","花结👖3"]},drawFilters:[{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"},{member:"dress"}]},{short:"花结👗1",member:"dress",cost:3,main:"voltage",once:!0,skill(t){let e={voltage:2};return t.getAllCards().length>=33&&(t.sp=="tz2"?e.heart=1:e.heart=2),e}},{short:"花结👗2",member:"dress",cost:3,main:"protect",once:!0,skill(t){let e={protect:1};return t.getAllCards().length>=33&&(t.sp=="mg2"?e.heart=1:e.heart=2),e}},{short:"花结👖3",member:"dress",cost:3,main:"reshuffle",reshuffle:!0,once:!0,skill(t){if(t.getAllCards().length>=30)return{heart:2}},drawFilters:[{unit:"srb"},{unit:"srb"},{unit:"srb"},{unit:"srb"},{unit:"srb"},{unit:"srb"}]},{short:"雪纺铃",member:8,cost:3,main:"mental",skill:{mental:1}},{short:"af缀",member:4,cost:9,main:"voltage",skill(t){let e={voltage:2,heart:10,ap:-20};return t.sp=="tz"&&(e.heart=9),e},afterSkill(t){t.sp=="tz2"&&t.trigger({ap:20})}},{short:"af慈",member:6,cost:9,main:"protect",skill(t){let e={protect:1,heart:10,ap:-20};return t.sp=="mg2"&&(e.heart=9),e},afterSkill(t){t.sp=="mg2"&&t.trigger({ap:15})}}];let _=class ee{constructor(e){this.score=0,this.te=[],this.sute=[],this.yama=e,this.mental=!0,this.protect=!1,this.apMax=20,this.ignition=!1,this.timesDict={},this.cardTimesDict={apSkip:0},this.timesCount=0,this.cardsCount=0,this.sp="",this.effect="",this.teMax=8,this.ap=8,this.apSpeed=2.5,this.drawHeartCount=0,this.jewelryCountTarget=0,this.hasCostEffect=!1,this.testResults=[]}getAllCards(){return[...this.te,...this.sute,...this.yama]}getDrawYama(){return this.yama.length?this.yama:this.sute}start(){this.sp=="kz2"&&(this.ap=1/0);for(let e=0;e<this.teMax;e++){let r=Math.floor(Math.random()*this.yama.length),a=this.yama.splice(r,1)[0];this.te.push(a)}this.hasCostEffect=["st1a"].includes(this.effect),this.testAllCards()}draw(e,r){this.yama.length||(this.yama=[...this.sute],this.sute=[],this.effect=="kj1a"&&this.yama.forEach(d=>{d.getMain(this)=="reshuffle"&&d.cost++}));let a;r?(a=this.yama.filter(d=>d.matchAttrs(r)),a.length||(a=this.yama)):a=this.yama;let i=Math.floor(Math.random()*a.length),m=a[i];this.yama.splice(this.yama.indexOf(m),1),this.te[e]=m,m.onDraw(this)}autoAp(){this.sp!="kz2"&&this.addAp(this.apSpeed)}useCard(e){var i,m,d,n,h,A,c;if(e==null){this.cardTimesDict.apSkip++,this.autoAp(),this.timesCount++;return}let r=this.te[e];this.cardTimesDict[r.short]||(this.cardTimesDict[r.short]=0),this.cardTimesDict[r.short]++;let a=r.isReshuffle(this);r.onSkill(this);for(let u of this.te)u.onCross(this,r);if(this.sp=="sy"&&this.score++,a){for(let u in this.te)u!=e&&this.sute.push(this.te[u]);(i=r.props)!=null&&i.yamaReshuffle&&this.yama.push(...this.sute.splice(0));for(let u=0;u<this.teMax;u++)this.draw(u,(d=(m=r.props)==null?void 0:m.drawFilters)==null?void 0:d[u])}else this.draw(e,(h=(n=r.props)==null?void 0:n.drawFilters)==null?void 0:h[0]);if((A=r.props)!=null&&A.once||((c=r.props)!=null&&c.yamaUse?this.yama.push(r):this.sute.push(r)),this.sp!="kz2"&&(this.addAp(-r.getCost(this.te)),this.autoAp()),r.cost=r.props.cost,r.afterSkill(this),this.timesCount++,this.cardsCount++,this.effect=="kj1b"&&this.cardsCount%5==0){this.sute.push(...this.te.splice(0));for(let u=0;u<this.teMax;u++)this.draw(u)}this.effect=="st1a"&&this.cardsCount%6==0&&this.getAllCards().forEach(u=>u.cost++),!this.protect&&this.sp!="mg2"&&(this.mental=!1),this.testAllCards()}calcTestDrawHeartCount(){let e=0,r=this.getAllCards(),a=r.filter(i=>i.short=="💎").length;if(a<this.jewelryCountTarget)for(let i=0;i<this.jewelryCountTarget-a;i++)r.push(new x("💎"));return r.forEach(i=>{e+=i.calcDrawHeartCount(this)}),this.drawHeartCount=e,e}testCard(e,r){var u,E,H,$,U,V,z,v,l;let a=this.te[e].short;if(a=="kol慈")return .01;if(["ritm吟","pa吟"].includes(a))return-.01;let i=new ee([]);for(let o of this.te)i.te.push(o.copy());for(let o of this.sute)i.sute.push(o.copy());for(let o of this.yama)i.yama.push(o.copy());i.mental=this.mental,i.protect=this.protect,i.ap=this.ap,i.apMax=this.apMax,i.apSpeed=this.apSpeed,i.ignition=this.ignition,i.timesDict=this.timesDict,i.sp=this.sp,i.jewelryCountTarget=this.jewelryCountTarget;let m,d;if(r&&(m=i.te[e].getCost(i.te),i.te[e]=r,d=i.te[e].getCost(i.te),(i.sp=="mg2"||i.sp=="tz2"||i.sp=="kz2")&&(m=1,d=1),d>i.apMax))return 0;let n=i.te[e],h=n.getSkill(this),A=n.isReshuffle(i);n.onSkill(i);for(let o of i.te)o.onCross(i,n);i.calcTestDrawHeartCount();let c=i.score;if(A&&(c+=i.drawHeartCount*this.teMax/(i.getAllCards().length+(((u=h==null?void 0:h.cards)==null?void 0:u.length)??0))),((H=(E=n.props)==null?void 0:E.drawFilters)==null?void 0:H.length)==1&&!r){let o=($=n.props)==null?void 0:$.drawFilters[0],g=i.getDrawYama().filter(k=>Object.keys(o).every(y=>k[y]==o[y]));g.forEach(k=>c+=i.testCard(e,k)/g.length)}return(U=n.props)!=null&&U.once&&(c+=((i.drawHeartCount-n.calcDrawHeartCount(i))/(i.getAllCards().length-1)-i.drawHeartCount/i.getAllCards().length)*this.teMax),(V=h==null?void 0:h.cards)!=null&&V.length&&(c+=(i.drawHeartCount/(i.getAllCards().length+((z=h==null?void 0:h.cards)==null?void 0:z.length))-i.drawHeartCount/i.getAllCards().length)*this.teMax),(v=h==null?void 0:h.cards)!=null&&v.length&&(c/=((l=h==null?void 0:h.cards)==null?void 0:l.length)+1),(h==null?void 0:h.ap)<=-i.apMax&&(c/=Math.ceil(Math.min(...i.te.filter(o=>o!=n).map(o=>o.getCost()))/i.apSpeed)),n.short=="上升姬芽"&&(c*=3/4),r&&(c/=(m+d)*m),c<0?0:c}testAllCards(){this.testResults=this.te.map((e,r)=>this.testCard(r))}trigger(e){e&&(this.addAp(e.ap),this.addHeart(e.heart),this.addVoltage(e.voltage),this.addMental(e.mental),this.addProtect(e.protect),this.subtractAp(e["ap-"]),this.addCard(e.cards))}addHeart(e){e&&(this.score+=e)}addVoltage(e){e&&this.sp=="tz"&&(this.score+=e,this.addAp(1*e))}addMental(e){e&&(e>0&&this.sp=="mg2"&&(this.score+=e,this.addAp(1*e)),e>0?this.mental=!0:e<0&&this.sp!="mg2"&&(this.mental=!1))}addProtect(e){e&&(this.sp=="mg2"&&(this.score+=e,this.addAp(2*e)),this.protect=!0)}subtractAp(e){if(e!=null&&e.length)for(let r of this.getAllCards())r.cost+=r.calcSubtractAp(e)}addCard(e){if(e!=null&&e.length)for(let r of e)this.yama.push(new x(r))}addAp(e){if(e){let r=this.ap+e;r>this.apMax&&(r=this.apMax),r<0&&(r=0),this.ap=Number(r.toFixed(2))}}};const le={class:"cost"},ie={key:0,class:"close"},ae={key:1,class:"test"},oe={key:2,class:"time"},ne={__name:"Card",props:{card:{type:x},stage:{type:_},te:{default:!1},close:{default:!1},pointerEvents:{default:"auto"}},setup(t){const e=t,r={heart:"rgb(204,39,39)","love+":"rgb(174,141,24)",voltage:"rgb(174,141,24)",mental:"rgb(48,124,24)",reshuffle:"rgb(134,82,195)",teMax:"rgb(134,82,195)",protect:"rgb(48,124,24)",dress:"rgb(134,82,195)",ap:"rgb(174,141,24)","ap-":"rgb(134,82,195)","":"transparent"},a={1:"#f8b500",2:"#5383c3",3:"#68be8d",4:"#ba2636",5:"#e7609e",6:"#c8c2c6",7:"#a2d7dd",8:"#fad764",9:"#9d8de2"};return(i,m)=>{var d,n;return p(),b("div",{class:"card",style:q({pointerEvents:t.te&&e.card.getCost(t.te?e.stage.te:void 0)>e.stage.ap?"none":e.pointerEvents})},[s("div",{class:"background",style:q({backgroundColor:a[e.card.member]?`${a[e.card.member]}`:"transparent"})},null,4),s("div",{style:q({fontWeight:e.card.isReshuffle(e.stage)?"bold":"",fontStyle:e.card.isReshuffle(e.stage)?"italic":""})},f(e.card.short),5),s("div",le,f(e.card.getCost(t.te?e.stage.te:void 0)),1),s("div",{class:"main",style:q({backgroundColor:r[e.card.getMain(e.stage)]})},null,4),e.close?(p(),b("div",ie,"×")):P("",!0),e.te?(p(),b("div",ae,f(Number(e.stage.testResults[e.stage.te.indexOf(e.card)].toFixed(2))),1)):P("",!0),((d=e.stage)==null?void 0:d.timesDict[e.card.short])!=null?(p(),b("div",oe,f((n=e.stage)==null?void 0:n.timesDict[e.card.short]),1)):P("",!0)],4)}}},R=Z(ne,[["__scopeId","data-v-5394f316"]]);function N(t){let e=[];for(let r=0;r<t.te.length;r++)t.te[r].getCost(t.te)<=t.ap&&t.testResults[r]>=0&&e.push(r);return e}function Y(t,e){let r=e.map(i=>t.testResults[i]),a=Math.max(...r);return e.filter((i,m)=>r[m]==a)}function W(t,e,r){let a=t.te.map((d,n)=>t.testResults[n]/t.te[n].getCost(t.te)),i=e.map(d=>a[d]),m=Math.max(...i);if(!r&&m<=0&&Math.max(...a)>0){let d=Math.min(...e.map(n=>t.te[n].getCost(t.te)));return d<=t.apSpeed?e.filter(n=>t.te[n].getCost(t.te)==d):[]}else return e.filter((d,n)=>i[n]==m)}function ue(t,e){let r=e.map(i=>{let m=t.te[i],d=0;return t.getAllCards().forEach(n=>{var h,A,c,u;(A=(h=n.props)==null?void 0:h.draw)!=null&&A["ap-"]&&(d+=m.calcSubtractAp((u=(c=n.props)==null?void 0:c.draw)==null?void 0:u["ap-"]))}),d}),a=Math.min(...r);return e.filter((i,m)=>r[m]==a)}function J(t,e){let r=e.filter(a=>{var i,m;return(m=(i=t.te[a].props)==null?void 0:i.drawFilters)==null?void 0:m.length});return r.length?r:e}function Q(t,e){let r=e.filter(a=>t.te[a].member=="dress");return r.length?r:e}function X(t,e,r){if(t.getAllCards().filter(m=>m.member=="jewelry").length>e)return r;let i=r.filter(m=>t.te[m].member!="jewelry");return i.length?i:r}function L(t,e=8,r){let a,i;if(r==null&&(r=t.strategy??(t.sp=="mg2"||t.sp=="tz2"||t.sp=="kz2"?"score":"cost"),t.ap+t.apSpeed*2>=t.apMax&&(r="score")),!t.ignition&&t.te.find(m=>m.short=="上升姬芽")&&t.te.find(m=>(m.getMain(t)=="mental"||m.getMain(t)=="protect")&&m.short!="上升姬芽")&&(r=="score"?a=Y(t,N(t).filter(m=>{let d=t.te[m];return(d.getMain(t)=="mental"||d.getMain(t)=="protect")&&d.short!="上升姬芽"}))[0]:a=W(t,N(t).filter(m=>{let d=t.te[m];return(d.getMain(t)=="mental"||d.getMain(t)=="protect")&&d.short!="上升姬芽"}),!0)[0]),a==null&&(i=t.te.findIndex(m=>m.short=="kol慈"),i>=0&&t.getAllCards().filter(m=>m.member=="jewelry").length<e&&t.te[i].getCost(t.te)<(r=="score"?t.ap:t.ap+Math.min(0,t.apSpeed-4))&&(a=i)),a==null&&(i=t.te.findIndex(m=>m.member=="jewelry"&&t.hasCostEffect),i>=0&&t.getAllCards().filter(m=>m.member=="jewelry").length>e&&(a=i)),a==null&&(r=="score"?a=J(t,X(t,e,Y(t,Q(t,N(t)))))[0]:a=ue(t,J(t,X(t,e,W(t,Q(t,N(t))))))[0]),N(t).length&&a==null)debugger;return a}window.strategyPlay=L;const me={class:"grid"},de=["open"],he={class:"grid"},fe={style:{"font-size":"small"}},pe=["disabled"],ce=["disabled"],ve=["disabled"],be=["disabled"],ge=["disabled"],ke=["disabled"],ye=["disabled"],Ce=["disabled"],we=["disabled"],Se=["disabled"],De=["disabled"],Te={style:{"text-align":"right"}},Ae={class:"flex-between"},Me={class:"flex-between"},xe={class:"flex-between"},je={class:"grid"},Fe={class:"grid"},Ee={class:"grid"},ze={colspan:"6"},Pe={colspan:"2"},$e={colspan:"2"},Ve={colspan:"2"},Ie={colspan:"2"},Re={colspan:"2"},Ne={colspan:"2"},He=["onClick"],Ue={colspan:"2",style:{"text-align":"center"}},qe={__name:"Stage",setup(t){const e=w(!1),r=w(!1),a=w([]),i=w(!1),m=w(),d=w(),n=w({qc:140,sh:3.3,apSpeed:2.6,sp:"",effect:"",jewelryCountTargetMin:0,jewelryCountTargetMax:20,cardTimes:373,skipTimes:100,strategy:"cost"}),h=w(10),A=K.map(v=>new x(v.short)).sort((v,l)=>typeof v.member=="number"&&typeof l.member=="number"?v.member-l.member:typeof v.member=="number"&&typeof l.member!="number"?-1:typeof v.member!="number"&&typeof l.member=="number"||v.member>l.member?1:v.member<l.member?-1:0),c=w(K.filter(v=>typeof v.member=="number").map(v=>new x(v.short)).slice(0,16)),u=w();window.getStage=()=>u.value;const E=()=>{u.value=new _([]),u.value.apSpeed=Number(n.value.apSpeed),u.value.sp=n.value.sp,u.value.effect=n.value.effect,u.value.strategy=n.value.strategy,u.value.yama=c.value.map(v=>new x(v.short))};E();const H=()=>{e.value=!1,E()},$=async v=>{var l;if(i.value=!1,e.value=!0,r.value=v,v){a.value.push({deck:c.value.map(o=>o.short).join(", "),formData:{...n.value},dict:{}});for(let o=Number(n.value.jewelryCountTargetMin);o<=Number(n.value.jewelryCountTargetMax)&&e.value;o++){let g=0,k=0,y={apSkip:0};for(let T of c.value)y[T.short]=0;for(let T=0;T<Number(n.value.skipTimes);T++){await U(),E(),u.value.jewelryCountTarget=o,u.value.start();for(let M=0;M<Number(n.value.cardTimes)&&e.value;M++)u.value.useCard(L(u.value,o));if(!e.value)break;g+=u.value.score,k+=(l=u.value.getAllCards().filter(M=>M.member=="jewelry"))==null?void 0:l.length;for(let M in u.value.cardTimesDict)y[M]||(y[M]=0),y[M]+=u.value.cardTimesDict[M]}if(!e.value)break;for(let T in y)y[T]=Number((y[T]/n.value.skipTimes).toFixed(2));a.value.at(-1).dict[o]={score:Number((g/n.value.skipTimes).toFixed(2)),jewelryCount:Number((k/n.value.skipTimes).toFixed(2)),cardTimesDict:y}}e.value=!1}else E(),u.value.jewelryCountTarget=h.value,u.value.start(),z()},U=async v=>new Promise(l=>setTimeout(l,v)),V=w(-1),z=()=>{V.value=L(u.value,h.value)};return(v,l)=>(p(),b("div",null,[!e.value||r.value?(p(),b(S,{key:0},[l[21]||(l[21]=s("h2",null,"DECK",-1)),l[22]||(l[22]=s("hr",null,null,-1)),s("div",me,[(p(!0),b(S,null,j(c.value,(o,g)=>(p(),I(R,{card:o,close:!0,onClick:k=>c.value.splice(g,1),"pointer-events":e.value?"none":"auto"},null,8,["card","onClick","pointer-events"]))),256))]),s("details",{open:i.value},[l[20]||(l[20]=s("summary",null,[C(" CARD "),s("hr")],-1)),s("div",he,[(p(!0),b(S,null,j(B(A),(o,g)=>(p(),I(R,{card:o,onClick:k=>c.value.push(new(B(x))(o.short)),"pointer-events":e.value?"none":"auto"},null,8,["card","onClick","pointer-events"]))),256))])],8,de)],64)):P("",!0),s("form",null,[l[39]||(l[39]=s("h2",null,"STAGE",-1)),l[40]||(l[40]=s("hr",null,null,-1)),s("div",fe,[l[23]||(l[23]=s("label",{for:"qc"},"曲长: ",-1)),D(s("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>n.value.qc=o),type:"text",disabled:e.value,id:"qc"},null,8,pe),[[F,n.value.qc]]),l[24]||(l[24]=C(" s  ")),l[25]||(l[25]=s("label",{for:"qc"},"生化值: ",-1)),D(s("input",{"onUpdate:modelValue":l[1]||(l[1]=o=>n.value.sh=o),type:"text",disabled:e.value,id:"sh"},null,8,ce),[[F,n.value.sh]]),l[26]||(l[26]=C("   ")),s("button",{onClick:l[2]||(l[2]=o=>{n.value.apSpeed=Number((1200/n.value.qc/n.value.sh).toFixed(2)),n.value.cardTimes=Math.floor(n.value.qc*8/3)}),disabled:e.value}," 计算AP回复速度/暂停回数 ",8,ve)]),s("div",null,[l[27]||(l[27]=s("label",{for:"ap"},"AP回复速度: ",-1)),D(s("input",{"onUpdate:modelValue":l[3]||(l[3]=o=>n.value.apSpeed=o),type:"text",disabled:e.value,id:"ap"},null,8,be),[[F,n.value.apSpeed]])]),s("div",null,[l[28]||(l[28]=s("label",{for:"card-time"},"暂停回数: ",-1)),D(s("input",{"onUpdate:modelValue":l[4]||(l[4]=o=>n.value.cardTimes=o),disabled:e.value,type:"number",id:"card-time"},null,8,ge),[[F,n.value.cardTimes]])]),s("div",null,[l[30]||(l[30]=s("label",{for:"sp"},"SP: ",-1)),D(s("select",{"onUpdate:modelValue":l[5]||(l[5]=o=>n.value.sp=o),disabled:e.value,id:"sp",onChange:l[6]||(l[6]=o=>n.value.sp.includes("2")?n.value.strategy="score":n.value.strategy="cost")},l[29]||(l[29]=[te('<option value="" data-v-7adcc5e8>--</option><option value="tz" data-v-7adcc5e8>舞会缀</option><option value="sy" data-v-7adcc5e8>舞会沙耶</option><option value="tz2" data-v-7adcc5e8>银河缀</option><option value="mg2" data-v-7adcc5e8>银河慈</option>',5)]),40,ke),[[O,n.value.sp]])]),s("div",null,[l[32]||(l[32]=s("label",{for:"effect"},"效果: ",-1)),D(s("select",{"onUpdate:modelValue":l[7]||(l[7]=o=>n.value.effect=o),disabled:e.value,id:"effect"},l[31]||(l[31]=[s("option",{value:""},"--",-1),s("option",{value:"st1a"}," (2025年1月公会战A) skill6回使用 deck全card消费AP+1 ",-1),s("option",{value:"kj1a"}," (2025年1月个人战A) 山札切 main效果reshuffle效果deck全card消费AP+1 ",-1),s("option",{value:"kj1b"}," (2025年1月个人战B) skill5回使用 手札全捨 山札手札上限引直 ",-1)]),8,ye),[[O,n.value.effect]])]),s("div",null,[l[34]||(l[34]=s("label",{for:"strategy"},"策略: ",-1)),D(s("select",{"onUpdate:modelValue":l[8]||(l[8]=o=>n.value.strategy=o),disabled:e.value,id:"strategy"},l[33]||(l[33]=[s("option",{value:"cost"},"pt/AP优先",-1),s("option",{value:"score"},"pt优先",-1)]),8,Ce),[[O,n.value.strategy]])]),s("div",null,[l[35]||(l[35]=s("label",{for:"jewelry"},"LIVE TARGET💎: ",-1)),D(s("input",{"onUpdate:modelValue":l[9]||(l[9]=o=>h.value=o),type:"number",id:"jewelry",onChange:l[10]||(l[10]=o=>{e.value&&!r.value&&(u.value.jewelryCountTarget=h.value,u.value.testAllCards(),z())})},null,544),[[F,h.value]])]),s("div",null,[l[36]||(l[36]=s("label",{for:"jewelry"},"SKIP TARGET💎: ",-1)),D(s("input",{"onUpdate:modelValue":l[11]||(l[11]=o=>n.value.jewelryCountTargetMin=o),disabled:e.value,type:"number",id:"jewelry"},null,8,we),[[F,n.value.jewelryCountTargetMin]]),l[37]||(l[37]=C(" ~ ")),D(s("input",{"onUpdate:modelValue":l[12]||(l[12]=o=>n.value.jewelryCountTargetMax=o),disabled:e.value,type:"number",id:"jewelry"},null,8,Se),[[F,n.value.jewelryCountTargetMax]])]),s("div",null,[l[38]||(l[38]=s("label",{for:"skip-time"},"SKIP回数: ",-1)),D(s("input",{"onUpdate:modelValue":l[13]||(l[13]=o=>n.value.skipTimes=o),disabled:e.value,type:"number",id:"skip-time"},null,8,De),[[F,n.value.skipTimes]])])]),s("div",Te,[e.value&&!r.value?(p(),b("button",{key:0,onClick:l[14]||(l[14]=o=>{d.value={key:u.value.jewelryCountTarget,score:u.value.score,cardTimesDict:u.value.cardTimesDict},G(()=>m.value.showModal())})}," LOG ")):P("",!0),e.value?(p(),b("button",{key:1,onClick:H},"RETIRE")):(p(),b(S,{key:2},[a.value.length?(p(),b("button",{key:0,onClick:l[15]||(l[15]=o=>a.value=[])}," CLEAR RESULTS ")):P("",!0),s("button",{onClick:l[16]||(l[16]=o=>$(!0))},"SKIP"),s("button",{onClick:l[17]||(l[17]=o=>$(!1))},"LIVE START")],64))]),e.value&&!r.value?(p(),b(S,{key:1},[s("h2",Ae,[s("div",null,f(u.value.score),1),s("div",null,f(u.value.timesCount)+"回",1)]),s("h2",Me,[s("div",null,f(u.value.sp=="mg2"?"∞":u.value.mental?"100%":"-%"),1),s("div",null,f(u.value.ignition?"🔥":"🚫")+" "+f(u.value.sp=="kz2"?"∞":u.value.ap),1)]),l[41]||(l[41]=s("div",{style:{"text-align":"right"}},null,-1)),s("h2",xe,[s("div",null,"手札 "+f(u.value.te.length),1),s("button",{onClick:l[18]||(l[18]=o=>{u.value.useCard(void 0),z()})}," AP SKIP ")]),l[42]||(l[42]=s("hr",null,null,-1)),s("div",je,[(p(!0),b(S,null,j(u.value.te,(o,g)=>(p(),I(R,{card:o,stage:u.value,te:!0,class:re({highlight:V.value==g}),onClick:k=>{u.value.useCard(g),z()}},null,8,["card","stage","class","onClick"]))),256))]),s("h2",null,"捨札 "+f(u.value.sute.length),1),l[43]||(l[43]=s("hr",null,null,-1)),s("div",Fe,[(p(!0),b(S,null,j(u.value.sute,(o,g)=>(p(),I(R,{card:o,stage:u.value,"pointer-events":"none"},null,8,["card","stage"]))),256))]),s("h2",null,"山札 "+f(u.value.yama.length),1),l[44]||(l[44]=s("hr",null,null,-1)),s("div",Ee,[(p(!0),b(S,null,j(u.value.yama,(o,g)=>(p(),I(R,{card:o,stage:u.value,"pointer-events":"none"},null,8,["card","stage"]))),256))])],64)):(p(!0),b(S,{key:2},j(a.value,(o,g)=>(p(),b("table",null,[s("thead",null,[s("tr",null,[s("td",ze,f(o.deck),1)]),s("tr",null,[s("td",Pe,"AP回复速度: "+f(o.formData.apSpeed),1),s("td",$e,"暂停回数: "+f(o.formData.cardTimes),1),s("td",Ve,"SKIP回数: "+f(o.formData.skipTimes),1)]),s("tr",null,[s("td",Ie,"SP: "+f(o.formData.sp),1),s("td",Re,"效果: "+f(o.formData.effect),1),s("td",Ne,"策略: "+f(o.formData.strategy),1)]),l[45]||(l[45]=s("tr",null,[s("td",null,[C("target"),s("br"),C("💎")]),s("td",null,[C("kol慈"),s("br"),C("回数")]),s("td",null,[C("💎"),s("br"),C("回数")]),s("td",null,[C("AP SKIP"),s("br"),C("回数")]),s("td",null,"pt"),s("td",null,"%")],-1))]),s("tbody",null,[(p(!0),b(S,null,j(o.dict,(k,y)=>(p(),b("tr",{style:{cursor:"pointer"},onClick:T=>{d.value={key:y,...k},G(()=>m.value.showModal())}},[s("td",null,f(y),1),s("td",null,f(k.cardTimesDict.kol慈??0),1),s("td",null,f(k.cardTimesDict["💎"]??0),1),s("td",null,f(k.cardTimesDict.apSkip),1),s("td",null,f(k.score),1),s("td",null,f(Number((k.score/Math.max(...Object.values(o.dict).map(T=>T.score))*100).toFixed(2))),1)],8,He))),256))])]))),256)),d.value?(p(),b("dialog",{key:3,ref_key:"dialog",ref:m},[s("table",null,[s("thead",null,[s("tr",null,[l[46]||(l[46]=s("td",null,"target💎",-1)),s("td",null,f(d.value.key),1)]),s("tr",null,[l[47]||(l[47]=s("td",null,"pt",-1)),s("td",null,f(d.value.score),1)])]),s("tbody",null,[(p(!0),b(S,null,j(d.value.cardTimesDict,(o,g)=>(p(),b("tr",null,[s("td",null,f(g),1),s("td",null,f(o)+"回",1)]))),256))]),s("tfoot",null,[s("tr",null,[s("td",Ue,[s("button",{onClick:l[19]||(l[19]=o=>d.value=void 0)},"关闭")])])])])],512)):P("",!0)]))}},Ke=Z(qe,[["__scopeId","data-v-7adcc5e8"]]);export{Ke as default};
